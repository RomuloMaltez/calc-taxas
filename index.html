<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadoras de Taxas - Porto Velho</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .calc-button.calculando {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
            transform: scale(0.98);
            cursor: wait;
        }

        .calc-button.calculando::after {
            content: " ‚è≥";
        }

        .result-box.sucesso {
            animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-button.active {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .section {
            background: white;
            margin: 30px 0;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .hidden {
            display: none;
        }

        .calculadoras-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 20px 0;
        }

        .calculadora-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .calculadora-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #9f7aea;
        }

        .calculadora-card.implementada {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border-color: #38a169;
            cursor: pointer;
        }

        .calculadora-card.implementada:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .calculadora-card.implementada::after {
            content: "üëÜ Clique aqui";
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: 0.8em;
            opacity: 0.8;
        }

        .calculadora-card.em-breve {
            background: linear-gradient(135deg, #fbb6ce 0%, #f093fb 100%);
            color: white;
            border-color: #f093fb;
        }

        .calculadora-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .calculadora-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .calculadora-status {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2d3748;
        }

        .logradouro-item input:disabled,
        .veiculo-item input:disabled,
        .publicidade-item input:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #e9ecef;
        }

        .logradouro-item,
        .veiculo-item,
        .publicidade-item {
            transition: all 0.2s ease;
        }

        .item-selecionado {
            background: linear-gradient(135deg, #e6fffa 0%, #f0fff4 100%) !important;
            border-color: #38b2ac !important;
            box-shadow: 0 2px 8px rgba(56, 178, 172, 0.2);
        }

        .form-group input:disabled,
        .form-group select:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #9f7aea;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .calc-button {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            font-weight: bold;
        }

        .calc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .calc-button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result-box {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            display: none;
        }

        .result-details {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            text-align: left;
            font-size: 1em;
            font-weight: normal;
        }

        .relatorio-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .relatorio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .relatorio-valor {
            font-size: 1.5em;
            font-weight: bold;
            color: #38a169;
        }

        .relatorio-total {
            background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 20px;
        }

        .tip-box {
            background: #fef5e7;
            border: 1px solid #fed7aa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #f6ad55;
            color: #2d3748;
        }

        .tip-box::before {
            content: "üí° ";
            font-size: 1.5em;
        }

        .factor-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9em;
        }

        .factor-table th,
        .factor-table td {
            border: 1px solid #e2e8f0;
            padding: 8px;
            text-align: center;
        }

        .factor-table th {
            background: linear-gradient(135deg, #e6fffa 0%, #f0fff4 100%);
            font-weight: bold;
        }

        .highlighted-row {
            background-color: #fed7aa !important;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .calculadoras-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .nav-buttons { flex-direction: column; align-items: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ Calculadoras de Taxas</h1>
            <p>Portal unificado para c√°lculo das taxas municipais de Porto Velho</p>
        </div>

        <div class="nav-buttons">
            <button class="nav-button active" onclick="showSection('home', this)">üè† In√≠cio</button>
            <button class="nav-button" onclick="showSection('calculator', this)">üßÆ Calculadora</button>
            <button class="nav-button" onclick="showSection('relatorios', this)">üìä Relat√≥rios</button>
        </div>

        <div id="home-section" class="section">
            <h2 style="color: #5a67d8; margin-bottom: 20px; text-align: center;">
                üèõÔ∏è Escolha a Calculadora Desejada (7 Dispon√≠veis)
            </h2>
            
            <div class="tip-box">
                <strong>Como usar:</strong> Escolha a taxa que voc√™ precisa calcular. As demais calculadoras ser√£o implementadas em breve.
            </div>

            <div style="background: #e6fffa; border: 1px solid #4fd1c7; border-radius: 8px; padding: 15px; margin: 20px 0; border-left: 4px solid #38b2ac; color: #2d3748;">
                <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Os relat√≥rios de c√°lculos ficam salvos durante sua sess√£o. Para manter os dados permanentemente, 
                use a fun√ß√£o "Exportar Relat√≥rios" antes de fechar o navegador.
            </div>

            <h3 style="color: #2d3748; margin: 30px 0 15px 0;">üìã Taxas de Fiscaliza√ß√£o e Controle</h3>
            <div class="calculadoras-grid">
                <div class="calculadora-card implementada" onclick="selectCalculadora('tffr')">
                    <span class="calculadora-icon">üè¢</span>
                    <div class="calculadora-title">Taxa de Fiscaliza√ß√£o do Funcionamento Regular (TFFR)</div>
                    <div class="calculadora-status">‚úÖ Dispon√≠vel - Clique para calcular</div>
                </div>
                
                <div class="calculadora-card implementada" onclick="selectCalculadora('publicidade')">
                    <span class="calculadora-icon">üì∫</span>
                    <div class="calculadora-title">Taxa de Fiscaliza√ß√£o de Exposi√ß√£o de Publicidade</div>
                    <div class="calculadora-status">‚úÖ Dispon√≠vel - Clique para calcular</div>
                </div>
                
                <div class="calculadora-card implementada" onclick="selectCalculadora('logradouro')">
                    <span class="calculadora-icon">üõ£Ô∏è</span>
                    <div class="calculadora-title">Taxa de Fiscaliza√ß√£o de Atividades em Logradouro P√∫blico</div>
                    <div class="calculadora-status">‚úÖ Dispon√≠vel - Clique para calcular</div>
                </div>
                
                <div class="calculadora-card implementada" onclick="selectCalculadora('sanitaria')">
                    <span class="calculadora-icon">üè•</span>
                    <div class="calculadora-title">Taxa de Fiscaliza√ß√£o Sanit√°ria</div>
                    <div class="calculadora-status">‚úÖ Dispon√≠vel - Clique para calcular</div>
                </div>
                
                <div class="calculadora-card implementada" onclick="selectCalculadora('ambientalFiscalizacao')">
                    <span class="calculadora-icon">üå±</span>
                    <div class="calculadora-title">Taxa de Fiscaliza√ß√£o Ambiental</div>
                    <div class="calculadora-status">‚úÖ Dispon√≠vel - Clique para calcular</div>
                </div>
                
                <div class="calculadora-card em-breve">
                    <span class="calculadora-icon">üöå</span>
                    <div class="calculadora-title">Taxa de Fiscaliza√ß√£o de Transportes P√∫blicos</div>
                    <div class="calculadora-status">üöß Em breve</div>
                </div>
            </div>

            <h3 style="color: #2d3748; margin: 30px 0 15px 0;">üìÑ Taxas de Licen√ßa</h3>
            <div class="calculadoras-grid">
                <div class="calculadora-card implementada" onclick="selectCalculadora('localizacao')">
                    <span class="calculadora-icon">üìç</span>
                    <div class="calculadora-title">Taxa de Licen√ßa de Localiza√ß√£o de Atividades</div>
                    <div class="calculadora-status">‚úÖ Dispon√≠vel - Clique para calcular</div>
                </div>
                
                <div class="calculadora-card em-breve">
                    <span class="calculadora-icon">üèóÔ∏è</span>
                    <div class="calculadora-title">Taxa de Licen√ßa de Execu√ß√£o de Obras</div>
                    <div class="calculadora-status">üöß Em breve</div>
                </div>
                
                <div class="calculadora-card implementada" onclick="selectCalculadora('publicidade')">
                    <span class="calculadora-icon">üì¢</span>
                    <div class="calculadora-title">Taxa de Licen√ßa de An√∫ncios Publicit√°rios</div>
                    <div class="calculadora-status">‚úÖ Dispon√≠vel - Clique para calcular</div>
                </div>
                
                <div class="calculadora-card em-breve">
                    <span class="calculadora-icon">üè∑Ô∏è</span>
                    <div class="calculadora-title">Taxa de Licen√ßa de Uso</div>
                    <div class="calculadora-status">üöß Em breve</div>
                </div>
                
                <div class="calculadora-card implementada" onclick="selectCalculadora('sanitaria')">
                    <span class="calculadora-icon">üß™</span>
                    <div class="calculadora-title">Taxa de Licen√ßa Sanit√°ria</div>
                    <div class="calculadora-status">‚úÖ Dispon√≠vel - Clique para calcular</div>
                </div>
                
                <div class="calculadora-card implementada" onclick="selectCalculadora('ambientalLicenca')">
                    <span class="calculadora-icon">üåø</span>
                    <div class="calculadora-title">Taxa de Licen√ßa Ambiental</div>
                    <div class="calculadora-status">‚úÖ Dispon√≠vel - Clique para calcular</div>
                </div>
                
                <div class="calculadora-card em-breve">
                    <span class="calculadora-icon">üé™</span>
                    <div class="calculadora-title">Taxa de Licen√ßa de Localiza√ß√£o Tempor√°ria de Eventos</div>
                    <div class="calculadora-status">üöß Em breve</div>
                </div>
                
                <div class="calculadora-card em-breve">
                    <span class="calculadora-icon">üöñ</span>
                    <div class="calculadora-title">Taxa de Licen√ßa de Transportes P√∫blicos</div>
                    <div class="calculadora-status">üöß Em breve</div>
                </div>
            </div>

            <h3 style="color: #2d3748; margin: 30px 0 15px 0;">üîç Outras Taxas</h3>
            <div class="calculadoras-grid">
                <div class="calculadora-card em-breve">
                    <span class="calculadora-icon">üëÅÔ∏è</span>
                    <div class="calculadora-title">Taxa de Vistoria</div>
                    <div class="calculadora-status">üöß Em breve</div>
                </div>
            </div>
        </div>

        <div id="calculator-section" class="section hidden">
            <div id="tffr-calculator" class="calculator-form hidden">
                <h2 style="color: #5a67d8; margin-bottom: 20px;">
                    üè¢ Calculadora TFFR - Taxa de Fiscaliza√ß√£o do Funcionamento Regular
                </h2>
                
                <div style="background: #f7fafc; border: 2px solid #9f7aea; border-radius: 10px; padding: 20px; margin: 20px 0;">
                    <div style="color: #2d3748; margin-bottom: 10px;"><strong>üßÆ F√≥rmula da TFFR:</strong></div>
                    <div style="font-family: 'Courier New', monospace; font-size: 1.1em; color: #4a5568; margin: 10px 0;">
                        TFFR = [(hd√óTfd) + (hn√óTfn)] √ó [(K√óC1) + (X√óC2) + (Y√óC3)]
                    </div>
                    <div style="font-size: 0.9em; color: #4a5568; line-height: 1.5;">
                        <strong>Onde:</strong><br>
                        ‚Ä¢ <strong>hd, hn:</strong> Custo por hora diurna (0,15√óUPF) e noturna (0,20√óUPF)<br>
                        ‚Ä¢ <strong>Tfd, Tfn:</strong> Tempo de funcionamento diurno e noturno<br>
                        ‚Ä¢ <strong>K, X, Y:</strong> Fatores de atividade conforme √°rea de cada tipo<br>
                        ‚Ä¢ <strong>C1, C2, C3:</strong> Coeficientes (1,0 / 0,75 / 0,25) por tipo de ocupa√ß√£o
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="upf-value">Valor da UPF (R$)</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="upf-value" class="upf-input" step="0.01" value="103.67" disabled>
                            <input type="checkbox" id="alterar-upf-tffr" class="alterar-upf-checkbox" data-target-input="upf-value" style="width: auto;">
                            <label for="alterar-upf-tffr" style="margin: 0; font-weight: normal;">Alterar</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="nome-estabelecimento">Nome do Estabelecimento</label>
                        <input type="text" id="nome-estabelecimento" placeholder="Ex: Loja Exemplo Ltda">
                    </div>
                </div>

                <h3 style="color: #2d3748; margin: 20px 0 10px 0;">‚è∞ Tempo de Funcionamento</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="tempo-diurno">Tempo Funcionamento Diurno (horas)</label>
                        <input type="number" id="tempo-diurno" step="0.5" placeholder="Ex: 8" min="0" max="12">
                        <small>Per√≠odo das 6h √†s 18h</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="tempo-noturno">Tempo Funcionamento Noturno (horas)</label>
                        <input type="number" id="tempo-noturno" step="0.5" placeholder="Ex: 0" min="0" max="12">
                        <small>Per√≠odo das 18h √†s 6h do dia seguinte</small>
                    </div>
                </div>

                <h3 style="color: #2d3748; margin: 20px 0 10px 0;">  √Åreas do Estabelecimento</h3>
                
                <div style="background: #e6fffa; border: 1px solid #4fd1c7; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #38b2ac; color: #2d3748;">
                    <strong>üìã Como preencher as √°reas:</strong><br>
                    ‚Ä¢ Informe apenas as √°reas que se aplicam ao seu estabelecimento<br>
                    ‚Ä¢ <strong>√Årea Constru√≠da:</strong> Espa√ßo coberto onde funciona a atividade<br>
                    ‚Ä¢ <strong>√Årea com Explora√ß√£o Econ√¥mica:</strong> P√°tio, estacionamento, √°rea descoberta utilizada<br>
                    ‚Ä¢ <strong>√Årea sem Explora√ß√£o:</strong> √Årea verde, espa√ßos n√£o utilizados economicamente<br>
                    ‚Ä¢ <em>As √°reas podem ser complementares ou independentes conforme seu estabelecimento</em>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="area-construida">üè¢ √Årea Ocupada Constru√≠da (m¬≤)</label>
                        <input type="number" id="area-construida" step="0.01" placeholder="Ex: 50" value="0">
                        <small style="color: #4a5568;">√Årea coberta onde funciona a atividade (Coeficiente C1 = 1,0)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="area-economica">üöó √Årea com Explora√ß√£o Econ√¥mica (m¬≤)</label>
                        <input type="number" id="area-economica" step="0.01" placeholder="Ex: 0" value="0">
                        <small style="color: #4a5568;">P√°tio, estacionamento utilizado (Coeficiente C2 = 0,75)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="area-sem-exploracao">üå≥ √Årea sem Explora√ß√£o Econ√¥mica (m¬≤)</label>
                        <input type="number" id="area-sem-exploracao" step="0.01" placeholder="Ex: 0" value="0">
                        <small style="color: #4a5568;">√Årea verde, espa√ßos n√£o utilizados (Coeficiente C3 = 0,25)</small>
                    </div>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <button class="calc-button" onclick="calcularTFFR()">üßÆ Calcular TFFR</button>
                    <button class="calc-button" style="background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);" onclick="limparFormulario()">üîÑ Limpar</button>
                </div>

                <div id="tffr-result" class="result-box">
                    </div>

                <div style="margin-top: 30px;">
                    <h3 style="color: #2d3748; margin-bottom: 15px;">üìä Tabela de Fatores de Atividade</h3>
                    <div style="overflow-x: auto;">
                        <table class="factor-table">
                            <thead>
                                <tr>
                                    <th>Categoria</th>
                                    <th>√Årea (m¬≤)</th>
                                    <th>Fator</th>
                                </tr>
                            </thead>
                            <tbody id="factor-table-body">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="localizacao-calculator" class="calculator-form hidden">
                <h2 style="color: #5a67d8; margin-bottom: 20px;">
                    üìç Calculadora Taxa de Licen√ßa de Localiza√ß√£o de Atividades
                </h2>
                
                <div style="background: #f7fafc; border: 2px solid #9f7aea; border-radius: 10px; padding: 20px; margin: 20px 0;">
                    <div style="color: #2d3748; margin-bottom: 10px;"><strong>üìã Sobre esta Taxa:</strong></div>
                    <div style="color: #4a5568; line-height: 1.6;">
                        <strong>Valor:</strong> 6 UPF (valor fixo)<br>
                        <strong>Quando √© devida:</strong> Para atividades econ√¥micas com estabelecimento f√≠sico de funcionamento<br>
                        <strong>Quando N√ÉO √© devida:</strong> Atividades porta-a-porta, presta√ß√£o de servi√ßos no domic√≠lio do cliente, atividades 100% online sem estabelecimento f√≠sico<br>
                        <strong>Periodicidade:</strong> Paga uma √∫nica vez at√© que a empresa mude de endere√ßo
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="upf-localizacao">Valor da UPF (R$)</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="upf-localizacao" class="upf-input" step="0.01" value="103.67" disabled>
                            <input type="checkbox" id="alterar-upf-localizacao" class="alterar-upf-checkbox" data-target-input="upf-localizacao" style="width: auto;">
                            <label for="alterar-upf-localizacao" style="margin: 0; font-weight: normal;">Alterar</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="nome-estabelecimento-localizacao">Nome do Estabelecimento</label>
                        <input type="text" id="nome-estabelecimento-localizacao" placeholder="Ex: Loja Exemplo Ltda">
                    </div>
                </div>

                <div class="form-group">
                    <label for="endereco-localizacao">Endere√ßo do Estabelecimento</label>
                    <input type="text" id="endereco-localizacao" placeholder="Ex: Rua Principal, 123 - Centro">
                </div>

                <div class="form-group">
                    <label for="tipo-atividade">Tipo de Atividade</label>
                    <select id="tipo-atividade">
                        <option value="">Selecione...</option>
                        <option value="fisica">Atividade com estabelecimento f√≠sico (SUJEITA √† taxa)</option>
                        <option value="nao-fisica">Atividade sem estabelecimento f√≠sico (N√ÉO sujeita √† taxa)</option>
                    </select>
                </div>

                <div id="info-nao-sujeita" style="background: #e6fffa; border: 1px solid #4fd1c7; border-radius: 8px; padding: 15px; margin: 20px 0; border-left: 4px solid #38b2ac; color: #2d3748; display: none;">
                    <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Esta atividade N√ÉO est√° sujeita √† Taxa de Licen√ßa de Localiza√ß√£o, pois n√£o possui estabelecimento f√≠sico de funcionamento.
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <button class="calc-button" onclick="calcularLocalizacao()">üßÆ Calcular Taxa</button>
                    <button class="calc-button" style="background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);" onclick="limparFormularioLocalizacao()">üîÑ Limpar</button>
                </div>

                <div id="localizacao-result" class="result-box">
                    </div>
            </div>

            <div id="publicidade-calculator" class="calculator-form hidden">
                <h2 style="color: #5a67d8; margin-bottom: 20px;">
                    üì¢ Calculadora de Taxas de Publicidade
                </h2>
                
                <div style="background: #f7fafc; border: 2px solid #9f7aea; border-radius: 10px; padding: 20px; margin: 20px 0;">
                    <div style="color: #2d3748; margin-bottom: 10px;"><strong>üìã Sobre estas Taxas:</strong></div>
                    <div style="color: #4a5568; line-height: 1.6;">
                        <strong>Taxa de Autoriza√ß√£o:</strong> 1 UPF - Paga uma √∫nica vez para autorizar qualquer modalidade de engenho publicit√°rio<br>
                        <strong>Taxa de Fiscaliza√ß√£o:</strong> Valores variados conforme o tipo de publicidade - Periodicidade anual ou por evento
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="upf-publicidade">Valor da UPF (R$)</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="upf-publicidade" class="upf-input" step="0.01" value="103.67" disabled>
                            <input type="checkbox" id="alterar-upf-publicidade" class="alterar-upf-checkbox" data-target-input="upf-publicidade" style="width: auto;">
                            <label for="alterar-upf-publicidade" style="margin: 0; font-weight: normal;">Alterar</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="nome-estabelecimento-publicidade">Nome do Estabelecimento</label>
                        <input type="text" id="nome-estabelecimento-publicidade" placeholder="Ex: Loja Exemplo Ltda">
                    </div>
                </div>

                <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üìã Taxa de Autoriza√ß√£o de Publicidade</h3>
                <div class="form-group">
                    <input type="checkbox" id="taxa-autorizacao" style="margin-right: 10px;">
                    <label for="taxa-autorizacao" style="display: inline;">Incluir Taxa de Autoriza√ß√£o de Publicidade (1 UPF - √önica)</label>
                </div>

                <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üìä Taxas de Fiscaliza√ß√£o de Publicidade</h3>
                
                <div id="tipos-publicidade">
                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-1">
                            <label for="tipo-2-1">Letreiros na parte externa dos edif√≠cios</label>
                            <input type="number" id="area-2-1" placeholder="m¬≤" step="0.01" style="width: 80px;">
                            <span style="font-weight: bold;">1 UPF/m¬≤/ano</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-2">
                            <label for="tipo-2-2">Ve√≠culo de transporte (interna/externa)</label>
                            <input type="number" id="area-2-2" placeholder="m¬≤" step="0.01" style="width: 80px;">
                            <span style="font-weight: bold;">1,5 UPF/m¬≤/ano</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-3">
                            <label for="tipo-2-3">Dispositivo televis√≠vel ou tecnologia similar</label>
                            <input type="number" id="area-2-3" placeholder="m¬≤" step="0.01" style="width: 80px;">
                            <span style="font-weight: bold;">1 UPF/m¬≤/ano</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-4">
                            <label for="tipo-2-4">Condu√ß√£o por pessoas em vias p√∫blicas</label>
                            <input type="number" id="qtd-2-4" placeholder="Qtd" step="1" style="width: 80px;">
                            <span style="font-weight: bold;">1 UPF/unid/ano</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-5">
                            <label for="tipo-2-5">Faixa exposta por tempo determinado</label>
                            <input type="number" id="area-2-5" placeholder="m¬≤" step="0.01" style="width: 80px;">
                            <span style="font-weight: bold;">0,1 UPF/m¬≤/evento</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-6">
                            <label for="tipo-2-6">Fl√¢mulas e bandeirolas (at√© 1m¬≤)</label>
                            <input type="number" id="qtd-2-6" placeholder="Qtd" step="1" style="width: 80px;">
                            <span style="font-weight: bold;">1 UPF/evento</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-7">
                            <label for="tipo-2-7">Placas indicativas de atividades</label>
                            <input type="number" id="area-2-7" placeholder="m¬≤" step="0.01" style="width: 80px;">
                            <span style="font-weight: bold;">1 UPF/m¬≤/ano</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-8">
                            <label for="tipo-2-8">Totem publicit√°rio</label>
                            <input type="number" id="area-2-8" placeholder="m¬≤" step="0.01" style="width: 80px;">
                            <span style="font-weight: bold;">1,5 UPF/m¬≤/ano</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-9">
                            <label for="tipo-2-9">Dispositivo infl√°vel</label>
                            <input type="number" id="qtd-2-9" placeholder="Qtd" step="1" style="width: 80px;">
                            <span style="font-weight: bold;">1 UPF/unid/evento</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-10">
                            <label for="tipo-2-10">Propaganda m√≥vel sonora</label>
                            <input type="number" id="qtd-2-10" placeholder="Qtd" step="1" style="width: 80px;">
                            <span style="font-weight: bold;">2 UPF/unid/ano</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-11">
                            <label for="tipo-2-11">Outdoor</label>
                            <input type="number" id="qtd-2-11" placeholder="Qtd" step="1" style="width: 80px;">
                            <span style="font-weight: bold;">2 UPF/unid/ano</span>
                        </div>
                    </div>

                    <div class="publicidade-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                            <input type="checkbox" id="tipo-2-12">
                            <label for="tipo-2-12">Painel luminoso ou iluminado</label>
                            <input type="number" id="area-2-12" placeholder="m¬≤" step="0.01" style="width: 80px;">
                            <span style="font-weight: bold;">0,2 UPF/m¬≤/ano</span>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <button class="calc-button" onclick="calcularPublicidade()">üßÆ Calcular Taxas</button>
                    <button class="calc-button" style="background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);" onclick="limparFormularioPublicidade()">üîÑ Limpar</button>
                </div>

                <div id="publicidade-result" class="result-box">
                    </div>
            </div>

            <div id="logradouro-calculator" class="calculator-form hidden">
                <h2 style="color: #5a67d8; margin-bottom: 20px;">
                    üõ£Ô∏è Calculadora de Taxas de Uso de Logradouro P√∫blico
                </h2>
                
                <div style="background: #f7fafc; border: 2px solid #9f7aea; border-radius: 10px; padding: 20px; margin: 20px 0;">
                    <div style="color: #2d3748; margin-bottom: 10px;"><strong>üìã Sobre estas Taxas:</strong></div>
                    <div style="color: #4a5568; line-height: 1.6;">
                        <strong>Taxa de Autoriza√ß√£o:</strong> 0,5 UPF - Paga uma √∫nica vez para qualquer modalidade de uso<br>
                        <strong>Taxa de Fiscaliza√ß√£o:</strong> Valores variados conforme o tipo de uso e periodicidade (anual, mensal, di√°ria ou por evento)
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="upf-logradouro">Valor da UPF (R$)</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="upf-logradouro" class="upf-input" step="0.01" value="103.67" disabled>
                            <input type="checkbox" id="alterar-upf-logradouro" class="alterar-upf-checkbox" data-target-input="upf-logradouro" style="width: auto;">
                            <label for="alterar-upf-logradouro" style="margin: 0; font-weight: normal;">Alterar</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="nome-estabelecimento-logradouro">Nome do Estabelecimento</label>
                        <input type="text" id="nome-estabelecimento-logradouro" placeholder="Ex: Loja Exemplo Ltda">
                    </div>
                </div>

                <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üìã Taxa de Autoriza√ß√£o de Uso</h3>
                <div class="form-group">
                    <input type="checkbox" id="taxa-autorizacao-logradouro" style="margin-right: 10px;">
                    <label for="taxa-autorizacao-logradouro" style="display: inline;">Incluir Taxa de Autoriza√ß√£o de Uso (0,5 UPF - √önica)</label>
                </div>

                <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üìä Taxas de Fiscaliza√ß√£o de Uso</h3>
                
                <div id="categorias-logradouro">
                    <div style="background: #e6fffa; border: 1px solid #4fd1c7; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <h4 style="color: #2d3748; margin-bottom: 10px;">üöö Atividades Itinerantes e Estacionadas</h4>
                        
                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1">
                                <label for="item-2-1">Itinerante em Local Franqueado ao P√∫blico</label>
                                <span style="width: 80px;"></span>
                                <span style="font-weight: bold;">2 UPF/ano</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-1">
                                <label for="item-2-1-1">Itinerante em eventos espor√°dicos</label>
                                <input type="number" id="dias-2-1-1" placeholder="Dias" step="1" style="width: 80px;">
                                <span style="font-weight: bold;">0,0056 UPF/dia</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-2">
                                <label for="item-2-1-2">Estacionado Tipo Guloseimas (Pequeno Porte)</label>
                                <span style="width: 80px;"></span>
                                <span style="font-weight: bold;">3 UPF/ano</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-2-1">
                                <label for="item-2-1-2-1">Guloseimas - eventos espor√°dicos</label>
                                <input type="number" id="dias-2-1-2-1" placeholder="Dias" step="1" style="width: 80px;">
                                <span style="font-weight: bold;">0,0083 UPF/dia</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-3">
                                <label for="item-2-1-3">Estacionado Com√©rcio em Geral</label>
                                <span style="width: 80px;"></span>
                                <span style="font-weight: bold;">5 UPF/ano</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-3-1">
                                <label for="item-2-1-3-1">Com√©rcio Geral - eventos espor√°dicos</label>
                                <input type="number" id="dias-2-1-3-1" placeholder="Dias" step="1" style="width: 80px;">
                                <span style="font-weight: bold;">0,014 UPF/dia</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-4">
                                <label for="item-2-1-4">Estacionado Tipo Banca at√© 2m¬≤</label>
                                <span style="width: 80px;"></span>
                                <span style="font-weight: bold;">0,5 UPF/m√™s</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-4-1">
                                <label for="item-2-1-4-1">Banca at√© 2m¬≤ - eventos espor√°dicos</label>
                                <input type="number" id="dias-2-1-4-1" placeholder="Dias" step="1" style="width: 80px;">
                                <span style="font-weight: bold;">0,0014 UPF/dia</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-5">
                                <label for="item-2-1-5">√Årea privada com barraca</label>
                                <input type="number" id="area-2-1-5" placeholder="m¬≤" step="0.01" style="width: 80px;">
                                <span style="font-weight: bold;">1,0 UPF/m¬≤/ano</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-5-1">
                                <label for="item-2-1-5-1">Barraca - eventos espor√°dicos</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="area-2-1-5-1" placeholder="m¬≤" step="0.01" style="width: 40px;">
                                    <input type="number" id="dias-2-1-5-1" placeholder="Dias" step="1" style="width: 40px;">
                                </div>
                                <span style="font-weight: bold;">0,003 UPF/m¬≤/dia</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-1-6">
                                <label for="item-2-1-6">Adicional Mesas e Cadeiras</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="area-2-1-6" placeholder="m¬≤" step="0.01" style="width: 40px;">
                                    <input type="number" id="dias-2-1-6" placeholder="Dias" step="1" style="width: 40px;">
                                </div>
                                <span style="font-weight: bold;">0,005 UPF/m¬≤/dia</span>
                            </div>
                        </div>
                    </div>

                    <div style="background: #fff5e6; border: 1px solid #fed7aa; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <h4 style="color: #2d3748; margin-bottom: 10px;">üè™ Feiras e Atividades Comerciais</h4>
                        
                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-2-1">
                                <label for="item-2-2-1">Feiras Populares (autoriza√ß√£o legal)</label>
                                <span style="width: 80px;"></span>
                                <span style="font-weight: bold;">5 UPF/ano</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-2-2">
                                <label for="item-2-2-2">Feiras livres itinerantes</label>
                                <span style="width: 80px;"></span>
                                <span style="font-weight: bold;">5 UPF/ano</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-2-3">
                                <label for="item-2-2-3">Atividades comerciais prec√°rias</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="area-2-2-3" placeholder="m¬≤" step="0.01" style="width: 40px;">
                                    <input type="number" id="dias-2-2-3" placeholder="Dias" step="1" style="width: 40px;">
                                </div>
                                <span style="font-weight: bold;">0,005 UPF/m¬≤/dia</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-2-4">
                                <label for="item-2-2-4">Festa Popular, Carnaval</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="area-2-2-4" placeholder="m¬≤" step="0.01" style="width: 40px;">
                                    <input type="number" id="dias-2-2-4" placeholder="Dias" step="1" style="width: 40px;">
                                </div>
                                <span style="font-weight: bold;">0,002 UPF/m¬≤/dia</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-2-5">
                                <label for="item-2-2-5">Feriados Religiosos, Natal, Ano-novo</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="area-2-2-5" placeholder="m¬≤" step="0.01" style="width: 40px;">
                                    <input type="number" id="dias-2-2-5" placeholder="Dias" step="1" style="width: 40px;">
                                </div>
                                <span style="font-weight: bold;">0,001 UPF/m¬≤/dia</span>
                            </div>
                        </div>
                    </div>

                    <div style="background: #f0fff4; border: 1px solid #9ae6b4; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <h4 style="color: #2d3748; margin-bottom: 10px;">ü™ë Mesas e Cadeiras na Cal√ßada</h4>
                        
                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-3">
                                <label for="item-2-3">Ocupa√ß√£o de Mesas e Cadeiras na Cal√ßada</label>
                                <input type="number" id="area-2-3" placeholder="m¬≤" step="0.01" style="width: 80px;">
                                <span style="font-weight: bold;">0,10 UPF/m¬≤/ano</span>
                            </div>
                        </div>
                    </div>

                    <div style="background: #fef5e7; border: 1px solid #fed7aa; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <h4 style="color: #2d3748; margin-bottom: 10px;">üöê Ve√≠culos Adaptados</h4>
                        
                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-4-1">
                                <label for="item-2-4-1">Ve√≠culo Adaptado</label>
                                <input type="number" id="area-2-4-1" placeholder="m¬≤" step="0.01" style="width: 80px;">
                                <span style="font-weight: bold;">1,20 UPF/m¬≤/ano</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-4-1-1">
                                <label for="item-2-4-1-1">Ve√≠culo - eventos espor√°dicos</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="area-2-4-1-1" placeholder="m¬≤" step="0.01" style="width: 40px;">
                                    <input type="number" id="dias-2-4-1-1" placeholder="Dias" step="1" style="width: 40px;">
                                </div>
                                <span style="font-weight: bold;">0,0033 UPF/m¬≤/dia</span>
                            </div>
                        </div>
                    </div>

                    <div style="background: #e6fffa; border: 1px solid #4fd1c7; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <h4 style="color: #2d3748; margin-bottom: 10px;">üì∞ Outros Usos</h4>
                        
                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-5">
                                <label for="item-2-5">Banca de Jornal e Revistas</label>
                                <input type="number" id="area-2-5" placeholder="m¬≤" step="0.01" style="width: 80px;">
                                <span style="font-weight: bold;">0,50 UPF/m¬≤/ano</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-6-1">
                                <label for="item-2-6-1">Com√©rcio em estrutura aprovada</label>
                                <input type="number" id="area-2-6-1" placeholder="m¬≤" step="0.01" style="width: 80px;">
                                <span style="font-weight: bold;">1,50 UPF/m¬≤/ano</span>
                            </div>
                        </div>

                        <div class="logradouro-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="item-2-6-3">
                                <label for="item-2-6-3">M√°quina de Sorvete e similares</label>
                                <span style="width: 80px;"></span>
                                <span style="font-weight: bold;">1,50 UPF/ano</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <button class="calc-button" onclick="calcularLogradouro()">üßÆ Calcular Taxas</button>
                    <button class="calc-button" style="background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);" onclick="limparFormularioLogradouro()">üîÑ Limpar</button>
                </div>

                <div id="logradouro-result" class="result-box">
                    </div>
            </div>

            <div id="sanitaria-calculator" class="calculator-form hidden">
                <h2 style="color: #5a67d8; margin-bottom: 20px;">
                    üß™ Calculadora de Taxas Sanit√°rias
                </h2>
                
                <div style="background: #f7fafc; border: 2px solid #9f7aea; border-radius: 10px; padding: 20px; margin: 20px 0;">
                    <div style="color: #2d3748; margin-bottom: 10px;"><strong>üìã Tipos de Taxas Sanit√°rias:</strong></div>
                    <div style="color: #4a5568; line-height: 1.6;">
                        <strong>Licen√ßa Sanit√°ria:</strong> Taxa simples baseada na √°rea do estabelecimento<br>
                        <strong>Taxa de Fiscaliza√ß√£o Sanit√°ria (TFS):</strong> C√°lculo complexo baseado em √°rea √ó tempo de funcionamento √ó custo operacional<br>
                        <strong>Inspe√ß√£o de Ve√≠culos:</strong> Valores fixos por tipo de ve√≠culo<br>
                        <strong>Outras modalidades:</strong> Eventos tempor√°rios, qualidade da √°gua, ambulantes
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="upf-sanitaria">Valor da UPF (R$)</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="upf-sanitaria" class="upf-input" step="0.01" value="103.67" disabled>
                            <input type="checkbox" id="alterar-upf-sanitaria" class="alterar-upf-checkbox" data-target-input="upf-sanitaria" style="width: auto;">
                            <label for="alterar-upf-sanitaria" style="margin: 0; font-weight: normal;">Alterar</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="nome-estabelecimento-sanitaria">Nome do Estabelecimento</label>
                        <input type="text" id="nome-estabelecimento-sanitaria" placeholder="Ex: Restaurante Exemplo">
                    </div>
                </div>

                <div class="form-group">
                    <label for="tipo-taxa-sanitaria">Tipo de Taxa Sanit√°ria</label>
                    <select id="tipo-taxa-sanitaria">
                        <option value="">Selecione...</option>
                        <option value="licenca">Licen√ßa Sanit√°ria (por √°rea)</option>
                        <option value="fiscalizacao">Taxa de Fiscaliza√ß√£o Sanit√°ria - TFS (f√≥rmula complexa)</option>
                        <option value="veiculo">Inspe√ß√£o Sanit√°ria de Ve√≠culos</option>
                        <option value="evento">Fiscaliza√ß√£o para Evento Tempor√°rio</option>
                        <option value="agua">Fiscaliza√ß√£o da Qualidade da √Ågua</option>
                        <option value="ambulante">Autoriza√ß√£o Sanit√°ria para Ambulantes</option>
                    </select>
                </div>

                <div id="secao-licenca" class="taxa-sanitaria-section" style="display: none;">
                    <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üìè Licen√ßa Sanit√°ria</h3>
                    <div class="form-group">
                        <label for="area-licenca">√Årea do Estabelecimento (m¬≤)</label>
                        <input type="number" id="area-licenca" step="0.01" placeholder="Ex: 50">
                    </div>
                    
                    <div class="form-group">
                        <input type="checkbox" id="reinspecao-licenca" style="margin-right: 10px;">
                        <label for="reinspecao-licenca" style="display: inline;">Incluir Reinspe√ß√£o Sanit√°ria (+1 UPF)</label>
                    </div>
                </div>

                <div id="secao-fiscalizacao" class="taxa-sanitaria-section" style="display: none;">
                    <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üîç Taxa de Fiscaliza√ß√£o Sanit√°ria (TFS)</h3>
                    
                    <div style="background: #e6fffa; border: 1px solid #4fd1c7; border-radius: 8px; padding: 15px; margin: 15px 0; border-left: 4px solid #38b2ac; color: #2d3748;">
                        <strong>üßÆ F√≥rmula TFS:</strong> UPF por √°rea √ó Tempo de funcionamento (%) √ó Custo operacional<br>
                        <small>Aplic√°vel apenas para estabelecimentos de <strong>Risco Alto = 3</strong></small>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="area-tfs">√Årea do Estabelecimento (m¬≤)</label>
                            <input type="number" id="area-tfs" step="0.01" placeholder="Ex: 50">
                        </div>
                        
                        <div class="form-group">
                            <label for="tempo-funcionamento-tfs">Tempo de Funcionamento Di√°rio</label>
                            <select id="tempo-funcionamento-tfs">
                                <option value="">Selecione...</option>
                                <option value="0.25">At√© 8h di√°rias (25%)</option>
                                <option value="0.50">8h-12h di√°rias (50%)</option>
                                <option value="0.75">12h-18h di√°rias (75%)</option>
                                <option value="1.00">18h-24h di√°rias (100%)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="secao-veiculo" class="taxa-sanitaria-section" style="display: none;">
                    <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üöë Inspe√ß√£o Sanit√°ria de Ve√≠culos</h3>
                    
                    <div id="tipos-veiculos">
                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-ambulancia">
                                <label for="veiculo-ambulancia">Ambul√¢ncia</label>
                                <input type="number" id="qtd-ambulancia" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">3,0 UPF/ano</span>
                            </div>
                        </div>

                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-ambulancia-vet">
                                <label for="veiculo-ambulancia-vet">Ambul√¢ncia veterin√°ria</label>
                                <input type="number" id="qtd-ambulancia-vet" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">2,0 UPF/ano</span>
                            </div>
                        </div>

                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-aviao-uti">
                                <label for="veiculo-aviao-uti">Avi√£o UTI</label>
                                <input type="number" id="qtd-aviao-uti" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">6,0 UPF/ano</span>
                            </div>
                        </div>

                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-bau-engate">
                                <label for="veiculo-bau-engate">Ba√∫ com engate (motos/carros)</label>
                                <input type="number" id="qtd-bau-engate" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">0,5 UPF/ano</span>
                            </div>
                        </div>

                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-caminhao-bau">
                                <label for="veiculo-caminhao-bau">Caminh√£o ba√∫ lonado</label>
                                <input type="number" id="qtd-caminhao-bau" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">1,0 UPF/ano</span>
                            </div>
                        </div>

                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-bau-isotermico">
                                <label for="veiculo-bau-isotermico">Caminh√£o ba√∫ isot√©rmico</label>
                                <input type="number" id="qtd-bau-isotermico" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">2,0 UPF/ano</span>
                            </div>
                        </div>

                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-pipa">
                                <label for="veiculo-pipa">Caminh√£o pipa (transporte √°gua)</label>
                                <input type="number" id="qtd-pipa" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">2,0 UPF/ano</span>
                            </div>
                        </div>

                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-limpa-fossa">
                                <label for="veiculo-limpa-fossa">Caminh√£o limpa fossa</label>
                                <input type="number" id="qtd-limpa-fossa" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">3,0 UPF/ano</span>
                            </div>
                        </div>

                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-trailer">
                                <label for="veiculo-trailer">Trailers</label>
                                <input type="number" id="qtd-trailer" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">1,5 UPF/ano</span>
                            </div>
                        </div>

                        <div class="veiculo-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto; gap: 15px; align-items: center;">
                                <input type="checkbox" id="veiculo-furgao">
                                <label for="veiculo-furgao">Ve√≠culos furg√µes</label>
                                <input type="number" id="qtd-furgao" placeholder="Qtd" step="1" style="width: 60px;">
                                <span style="font-weight: bold;">2,0 UPF/ano</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="secao-evento" class="taxa-sanitaria-section" style="display: none;">
                    <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üé™ Fiscaliza√ß√£o para Evento Tempor√°rio</h3>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="area-manipulacao">√Årea de Manipula√ß√£o de Alimentos (m¬≤)</label>
                            <input type="number" id="area-manipulacao" step="0.01" placeholder="Ex: 15">
                        </div>
                        
                        <div class="form-group">
                            <label for="dias-evento">N√∫mero de Dias do Evento</label>
                            <input type="number" id="dias-evento" step="1" placeholder="Ex: 3">
                        </div>
                        
                        <div class="form-group">
                            <label for="pontos-comercializacao">Pontos de Comercializa√ß√£o</label>
                            <input type="number" id="pontos-comercializacao" step="1" placeholder="Ex: 2" value="1">
                        </div>
                    </div>
                </div>

                <div id="secao-agua" class="taxa-sanitaria-section" style="display: none;">
                    <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üíß Fiscaliza√ß√£o da Qualidade da √Ågua</h3>
                    
                    <div class="form-group">
                        <label for="unidades-habitacionais">N√∫mero de Unidades Habitacionais</label>
                        <input type="number" id="unidades-habitacionais" step="1" placeholder="Ex: 50">
                    </div>
                </div>

                <div id="secao-ambulante" class="taxa-sanitaria-section" style="display: none;">
                    <h3 style="color: #2d3748; margin: 20px 0 10px 0;">üõí Autoriza√ß√£o Sanit√°ria para Ambulantes</h3>
                    
                    <div style="background: #e6fffa; border: 1px solid #4fd1c7; border-radius: 8px; padding: 15px; margin: 15px 0; border-left: 4px solid #38b2ac; color: #2d3748;">
                        <strong>üìã Valor fixo:</strong> 1,00 UPF por ano para balc√µes, mesas, barracas, carrinhos ou similares.
                    </div>
                    
                    <div class="form-group">
                        <label for="qtd-ambulantes">Quantidade de Estruturas Ambulantes</label>
                        <input type="number" id="qtd-ambulantes" step="1" placeholder="Ex: 1" value="1">
                    </div>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <button class="calc-button" onclick="calcularSanitaria()">üßÆ Calcular Taxa</button>
                    <button class="calc-button" style="background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);" onclick="limparFormularioSanitaria()">üîÑ Limpar</button>
                </div>

                <div id="sanitaria-result" class="result-box">
                    </div>
            </div>

            <div id="ambientalFiscalizacao-calculator" class="calculator-form hidden">
                <h2 style="color: #5a67d8; margin-bottom: 20px;">
                    üå± Calculadora de Taxa de Fiscaliza√ß√£o Ambiental (ATM)
                </h2>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="upf-ambiental-fiscalizacao">Valor da UPF (R$)</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="upf-ambiental-fiscalizacao" class="upf-input" step="0.01" value="103.67" disabled>
                            <input type="checkbox" id="alterar-upf-ambiental-fiscalizacao" class="alterar-upf-checkbox" data-target-input="upf-ambiental-fiscalizacao" style="width: auto;">
                            <label for="alterar-upf-ambiental-fiscalizacao" style="margin: 0; font-weight: normal;">Alterar</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="nome-empreendimento-fiscalizacao">Nome do Empreendimento</label>
                        <input type="text" id="nome-empreendimento-fiscalizacao" placeholder="Ex: Projeto Ambiental Exemplo">
                    </div>
                </div>

                <div class="form-group">
                    <label for="porte-fiscalizacao">Porte do Empreendimento</label>
                    <select id="porte-fiscalizacao">
                        <option value="">Selecione o Porte...</option>
                        <option value="lapp">Pequeno Porte (LAPP)</option>
                        <option value="lamp">M√©dio Porte (LAMP)</option>
                        <option value="lagp">Grande Porte (LAGP)</option>
                        <option value="laep">Porte Excepcional (LAEP)</option>
                    </select>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <button class="calc-button" onclick="calcularAmbientalFiscalizacao()">üßÆ Calcular Taxa</button>
                    <button class="calc-button" style="background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);" onclick="limparFormularioAmbientalFiscalizacao()">üîÑ Limpar</button>
                </div>

                <div id="ambiental-fiscalizacao-result" class="result-box">
                    </div>
            </div>

            <div id="ambientalLicenca-calculator" class="calculator-form hidden">
                <h2 style="color: #5a67d8; margin-bottom: 20px;">
                    üåø Calculadora de Taxa de Licen√ßa Ambiental
                </h2>

                <div class="form-grid">
                     <div class="form-group">
                        <label for="upf-ambiental-licenca">Valor da UPF (R$)</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="upf-ambiental-licenca" class="upf-input" step="0.01" value="103.67" disabled>
                            <input type="checkbox" id="alterar-upf-ambiental-licenca" class="alterar-upf-checkbox" data-target-input="upf-ambiental-licenca" style="width: auto;">
                            <label for="alterar-upf-ambiental-licenca" style="margin: 0; font-weight: normal;">Alterar</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="nome-empreendimento-licenca">Nome do Empreendimento</label>
                        <input type="text" id="nome-empreendimento-licenca" placeholder="Ex: Usina Hidrel√©trica Exemplo">
                    </div>
                </div>

                <div style="background: #f0fff4; border: 1px solid #9ae6b4; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <h3 style="color: #2d3748; margin-bottom: 15px;">üìÑ Licen√ßa Principal</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="tipo-licenca-ambiental">Tipo de Licen√ßa</label>
                            <select id="tipo-licenca-ambiental">
                                <option value="">Selecione...</option>
                                <option value="lap">Licen√ßa Pr√©via (LAP)</option>
                                <option value="lai">Licen√ßa de Instala√ß√£o (LAI)</option>
                                <option value="lao">Licen√ßa de Opera√ß√£o (LAO)</option>
                                <option value="las">Licen√ßa Ambiental Simplificada (LAS)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="porte-licenca-ambiental">Porte do Empreendimento</label>
                            <select id="porte-licenca-ambiental">
                                <option value="">Selecione...</option>
                                <option value="lapp">Pequeno Porte (LAPP)</option>
                                <option value="lamp">M√©dio Porte (LAMP)</option>
                                <option value="lagp">Grande Porte (LAGP)</option>
                                <option value="laep">Porte Excepcional (LAEP)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="background: #fef5e7; border: 1px solid #fed7aa; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <h3 style="color: #2d3748; margin-bottom: 15px;">‚ûï Servi√ßos Adicionais</h3>
                    
                    <div class="form-group">
                        <input type="checkbox" id="incluir-eia-rima" style="margin-right: 10px;">
                        <label for="incluir-eia-rima" style="display: inline;">Incluir An√°lise de Estudo de Impacto Ambiental (EIA/RIMA)</label>
                    </div>

                    <div class="form-group">
                        <input type="checkbox" id="incluir-eiv-riv" style="margin-right: 10px;">
                        <label for="incluir-eiv-riv" style="display: inline;">Incluir An√°lise de Estudo de Impacto de Vizinhan√ßa (EIV/RIV)</label>
                    </div>
                    
                    <div class="form-group">
                        <input type="checkbox" id="incluir-certidao-viabilidade" style="margin-right: 10px;" onchange="toggleViabilidadePorte(this.checked)">
                        <label for="incluir-certidao-viabilidade" style="display: inline;">Incluir Certid√£o de Viabilidade Ambiental</label>
                    </div>
                    <div id="porte-viabilidade-group" class="form-group hidden">
                        <label for="porte-certidao-viabilidade">Porte da Certid√£o</label>
                        <select id="porte-certidao-viabilidade">
                            <option value="">Selecione...</option>
                            <option value="minimo">M√≠nimo</option>
                            <option value="pequeno">Pequeno</option>
                            <option value="medio">M√©dio</option>
                            <option value="grande">Grande</option>
                            <option value="excepcional">Excepcional</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <input type="checkbox" id="incluir-cadastro-simplificado" style="margin-right: 10px;">
                        <label for="incluir-cadastro-simplificado" style="display: inline;">Incluir Cadastro Ambiental Simplificado</label>
                    </div>
                </div>


                <div style="text-align: center; margin: 30px 0;">
                    <button class="calc-button" onclick="calcularAmbientalLicenca()">üßÆ Calcular Taxas</button>
                    <button class="calc-button" style="background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);" onclick="limparFormularioAmbientalLicenca()">üîÑ Limpar</button>
                </div>

                <div id="ambiental-licenca-result" class="result-box">
                    </div>
            </div>

        </div>

        <div id="relatorios-section" class="section hidden">
            <h2 style="color: #5a67d8; margin-bottom: 20px;">
                üìä Relat√≥rios de C√°lculos Realizados
            </h2>
            
            <div style="background: #fff5e6; border: 1px solid #fed7aa; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #f6ad55; color: #2d3748;">
                <strong>‚ö†Ô∏è Armazenamento Tempor√°rio:</strong> Os relat√≥rios ficam salvos apenas durante esta sess√£o. 
                Para guardar permanentemente, use o bot√£o "üìÑ Exportar Relat√≥rios" para baixar um arquivo.
            </div>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <button class="calc-button" onclick="limparRelatorios()">üóëÔ∏è Limpar Todos os Relat√≥rios</button>
                <button class="calc-button" style="background: linear-gradient(135deg, #9f7aea 0%, #667eea 100%);" onclick="exportarRelatorios()">üìÑ Exportar Relat√≥rios</button>
            </div>

            <div id="relatorios-container">
                <div style="text-align: center; color: #a0aec0; font-size: 1.2em; margin: 50px 0;">
                    üìã Nenhum c√°lculo realizado ainda
                </div>
            </div>

            <div id="relatorio-total" class="relatorio-total" style="display: none;">
                <h3>üí∞ Total Geral de Todas as Taxas</h3>
                <div id="valor-total-geral">R$ 0,00</div>
            </div>
        </div>
    </div>

    <script>
        // Estado global da aplica√ß√£o (inicializa√ß√£o segura)
        let relatorios = [];
        let currentCalculator = 'tffr';

        // --- BASES DE DADOS DAS TAXAS ---
        const taxasLicencaAmbiental = { 
            lapp: { lap: 1, lai: 2, lao: 2 },
            lamp: { lap: 3, lai: 6, lao: 6 },
            lagp: { lap: 12, lai: 24, lao: 24 },
            laep: { lap: 12, lai: 24, lao: 24 },
            las: { lai: 3 } 
        };

        const taxasAnaliseEstudo = { 
            eia_rima: { lapp: 1, lamp: 3, lagp: 5, laep: 10 },
            eiv_riv: { lapp: 1, lamp: 3, lagp: 5, laep: 10 }
        };

        const taxasDiversasAmbiental = { 
            certidaoViabilidade: { minimo: 1, pequeno: 2, medio: 3.5, grande: 4, excepcional: 6 },
            cadastroSimplificado: 0.32
        };

        const taxasFiscalizacaoAmbiental = { 
            lapp: 3.0,
            lamp: 4.5,
            lagp: 6.0,
            laep: 10.0
        };
        
        // Fun√ß√£o para salvar relat√≥rios (simulando localStorage)
        function salvarRelatorios() {
            // Em um ambiente real, usaria localStorage
            // localStorage.setItem('relatorios_taxas', JSON.stringify(relatorios));
            console.log('Relat√≥rios salvos em mem√≥ria:', relatorios.length, 'itens');
        }
        
        // Fun√ß√£o para carregar relat√≥rios (simulando localStorage)
        function carregarRelatorios() {
            // Em um ambiente real, carregaria do localStorage
            // relatorios = JSON.parse(localStorage.getItem('relatorios_taxas') || '[]');
            if (!Array.isArray(relatorios)) {
                relatorios = [];
            }
            console.log('Relat√≥rios carregados da mem√≥ria:', relatorios.length, 'itens');
        }

        // Dados da tabela de fatores de atividade
        const fatoresAtividade = [
            { categoria: "PEQUENA ATIVIDADE", area: "At√© 30m¬≤", fator: 1.00 }, { categoria: "M√âDIA ATIVIDADE", area: "31-40m¬≤", fator: 1.10 },
            { categoria: "", area: "41-50m¬≤", fator: 1.20 }, { categoria: "", area: "51-60m¬≤", fator: 1.30 },
            { categoria: "", area: "61-70m¬≤", fator: 1.40 }, { categoria: "", area: "71-80m¬≤", fator: 1.50 },
            { categoria: "", area: "81-90m¬≤", fator: 1.60 }, { categoria: "", area: "91-100m¬≤", fator: 1.70 },
            { categoria: "GRANDE ATIVIDADE", area: "101-110m¬≤", fator: 2.00 }, { categoria: "", area: "111-120m¬≤", fator: 2.10 },
            { categoria: "", area: "121-130m¬≤", fator: 2.20 }, { categoria: "", area: "131-140m¬≤", fator: 2.30 },
            { categoria: "", area: "141-150m¬≤", fator: 2.50 }, { categoria: "", area: "151-200m¬≤", fator: 3.00 },
            { categoria: "", area: "201-250m¬≤", fator: 3.80 }, { categoria: "", area: "251-300m¬≤", fator: 4.60 },
            { categoria: "", area: "301-350m¬≤", fator: 5.40 }, { categoria: "", area: "351-400m¬≤", fator: 6.20 },
            { categoria: "", area: "401-450m¬≤", fator: 7.00 }, { categoria: "", area: "451-500m¬≤", fator: 7.80 },
            { categoria: "", area: "501-550m¬≤", fator: 8.60 }, { categoria: "", area: "551-600m¬≤", fator: 9.40 },
            { categoria: "", area: "601-650m¬≤", fator: 10.20 }, { categoria: "", area: "651-700m¬≤", fator: 11.00 },
            { categoria: "", area: "701-750m¬≤", fator: 11.80 }, { categoria: "", area: "751-800m¬≤", fator: 12.60 },
            { categoria: "", area: "801-850m¬≤", fator: 13.40 }, { categoria: "", area: "851-900m¬≤", fator: 14.20 },
            { categoria: "", area: "901-950m¬≤", fator: 15.00 }, { categoria: "", area: "951-1.000m¬≤", fator: 15.80 },
            { categoria: "", area: "1.001-1.050m¬≤", fator: 16.60 }, { categoria: "", area: "1.051-1.100m¬≤", fator: 17.40 },
            { categoria: "", area: "1.101-1.150m¬≤", fator: 18.20 }, { categoria: "", area: "1.151-1.200m¬≤", fator: 19.00 },
            { categoria: "", area: "1.201-1.250m¬≤", fator: 19.80 }, { categoria: "", area: "1.251-1.300m¬≤", fator: 20.60 },
            { categoria: "", area: "1.301-1.350m¬≤", fator: 21.40 }, { categoria: "", area: "1.351-1.400m¬≤", fator: 22.20 },
            { categoria: "", area: "1.401-1.450m¬≤", fator: 23.00 }, { categoria: "", area: "1.451-1.500m¬≤", fator: 23.80 },
            { categoria: "", area: "Acima de 1.500m¬≤", fator: "23,80 + (0,70 √ó cada 50m¬≤ extras)" }
        ];

        // Navega√ß√£o entre se√ß√µes
        function showSection(sectionName, buttonElement = null) {
            document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
            document.querySelectorAll('.nav-button').forEach(button => button.classList.remove('active'));
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            if (buttonElement) buttonElement.classList.add('active');
            if (sectionName === 'relatorios') atualizarRelatorios();
        }

        // Selecionar calculadora
        function selectCalculadora(tipo) {
            currentCalculator = tipo;
            const validCalculators = ['tffr', 'localizacao', 'publicidade', 'logradouro', 'sanitaria', 'ambientalFiscalizacao', 'ambientalLicenca'];
            
            if (validCalculators.includes(tipo)) {
                const card = event.target.closest('.calculadora-card');
                if (card) {
                    card.style.transform = 'scale(0.95)';
                    setTimeout(() => { card.style.transform = ''; }, 150);
                }
                setTimeout(() => {
                    showSection('calculator', document.querySelector('.nav-button:nth-child(2)'));
                    mostrarCalculadora(tipo);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 200);
            } else {
                alert('Esta calculadora ainda est√° em desenvolvimento.');
            }
        }

        // Mostrar calculadora espec√≠fica
        function mostrarCalculadora(tipo) {
            document.querySelectorAll('.calculator-form').forEach(calc => calc.classList.add('hidden'));
            const calculadora = document.getElementById(tipo + '-calculator');
            if (calculadora) {
                calculadora.classList.remove('hidden');
                if (tipo === 'tffr') preencherTabelaFatores(); // Chamada restaurada
                else if (tipo === 'localizacao') configurarCalculadoraLocalizacao();
                else if (tipo === 'publicidade') configurarCalculadoraPublicidade();
                else if (tipo === 'logradouro') configurarCalculadoraLogradouro();
                else if (tipo === 'sanitaria') configurarCalculadoraSanitaria();
                else if (tipo === 'ambientalLicenca') configurarCalculadoraLicencaAmbiental();
            }
        }

        // --- FUN√á√ÉO RESTAURADA ---
        // Preencher tabela de fatores de atividade
        function preencherTabelaFatores() {
            const tbody = document.getElementById('factor-table-body');
            tbody.innerHTML = ''; // Limpar antes de preencher
            
            fatoresAtividade.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="font-weight: ${item.categoria ? 'bold' : 'normal'};">${item.categoria}</td>
                    <td>${item.area}</td>
                    <td>${typeof item.fator === 'number' ? item.fator.toFixed(2) : item.fator}</td>
                `;
                tbody.appendChild(tr);
            });
        }


        // --- L√ìGICA DE CONFIGURA√á√ÉO DOS FORMUL√ÅRIOS ---
        function configurarCalculadoraLocalizacao() {
            document.getElementById('tipo-atividade').addEventListener('change', function() {
                document.getElementById('info-nao-sujeita').style.display = (this.value === 'nao-fisica') ? 'block' : 'none';
            });
        }

        function configurarCalculadoraPublicidade() {
            document.querySelectorAll('#tipos-publicidade input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', function() {
                    const item = this.closest('.publicidade-item');
                    const inputs = item.querySelectorAll('input[type="number"]');
                    inputs.forEach(input => { input.disabled = !this.checked; if (!this.checked) input.value = ''; });
                    item.classList.toggle('item-selecionado', this.checked);
                });
            });
        }

        function configurarCalculadoraLogradouro() {
            document.querySelectorAll('#categorias-logradouro input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', function() {
                    const item = this.closest('.logradouro-item');
                    const inputs = item.querySelectorAll('input[type="number"]');
                    inputs.forEach(input => { input.disabled = !this.checked; if (!this.checked) input.value = ''; });
                    item.classList.toggle('item-selecionado', this.checked);
                });
            });
        }

        function configurarCalculadoraSanitaria() {
            const tipoTaxa = document.getElementById('tipo-taxa-sanitaria');
            const secoes = document.querySelectorAll('.taxa-sanitaria-section');
            tipoTaxa.addEventListener('change', function() {
                secoes.forEach(secao => secao.style.display = 'none');
                if (this.value) {
                    const secao = document.getElementById(`secao-${this.value}`);
                    if (secao) secao.style.display = 'block';
                }
            });

            document.querySelectorAll('#tipos-veiculos input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', function() {
                    const item = this.closest('.veiculo-item');
                    const input = item.querySelector('input[type="number"]');
                    input.disabled = !this.checked;
                    if (!this.checked) input.value = '';
                    item.classList.toggle('item-selecionado', this.checked);
                });
            });
        }

        function configurarCalculadoraLicencaAmbiental() {
            const tipoLicencaSelect = document.getElementById('tipo-licenca-ambiental');
            const porteLicencaSelect = document.getElementById('porte-licenca-ambiental');

            tipoLicencaSelect.addEventListener('change', function() {
                const isLAS = this.value === 'las';
                // Para LAS, o porte n√£o √© aplic√°vel, desabilita a sele√ß√£o.
                porteLicencaSelect.disabled = isLAS;
                if(isLAS) porteLicencaSelect.value = '';
            });
        }

        function toggleViabilidadePorte(checked) {
            document.getElementById('porte-viabilidade-group').classList.toggle('hidden', !checked);
        }

        // --- L√ìGICA DE C√ÅLCULO ---

        function obterFatorAtividade(area) {
            if (area <= 30) return 1.00; if (area <= 40) return 1.10; if (area <= 50) return 1.20;
            if (area <= 60) return 1.30; if (area <= 70) return 1.40; if (area <= 80) return 1.50;
            if (area <= 90) return 1.60; if (area <= 100) return 1.70; if (area <= 110) return 2.00;
            if (area <= 120) return 2.10; if (area <= 130) return 2.20; if (area <= 140) return 2.30;
            if (area <= 150) return 2.50; if (area <= 200) return 3.00; if (area <= 250) return 3.80;
            if (area <= 300) return 4.60; if (area <= 350) return 5.40; if (area <= 400) return 6.20;
            if (area <= 450) return 7.00; if (area <= 500) return 7.80; if (area <= 550) return 8.60;
            if (area <= 600) return 9.40; if (area <= 650) return 10.20; if (area <= 700) return 11.00;
            if (area <= 750) return 11.80; if (area <= 800) return 12.60; if (area <= 850) return 13.40;
            if (area <= 900) return 14.20; if (area <= 950) return 15.00; if (area <= 1000) return 15.80;
            if (area <= 1050) return 16.60; if (area <= 1100) return 17.40; if (area <= 1150) return 18.20;
            if (area <= 1200) return 19.00; if (area <= 1250) return 19.80; if (area <= 1300) return 20.60;
            if (area <= 1350) return 21.40; if (area <= 1400) return 22.20; if (area <= 1450) return 23.00;
            if (area <= 1500) return 23.80;
            return 23.80 + (Math.floor((area - 1500) / 50) * 0.70);
        }

        function calcularTFFR() {
            try {
                if (typeof relatorios === 'undefined') relatorios = [];
                const upfValue = parseFloat(document.getElementById('upf-value').value) || 0;
                const nomeEstabelecimento = document.getElementById('nome-estabelecimento').value || 'Estabelecimento n√£o informado';
                const tempoDiurno = parseFloat(document.getElementById('tempo-diurno').value) || 0;
                const tempoNoturno = parseFloat(document.getElementById('tempo-noturno').value) || 0;
                const areaConstruida = parseFloat(document.getElementById('area-construida').value) || 0; // Garantir que √© 0 se NaN
                const areaEconomica = parseFloat(document.getElementById('area-economica').value) || 0;   // Garantir que √© 0 se NaN
                const areaSemExploracao = parseFloat(document.getElementById('area-sem-exploracao').value) || 0; // Garantir que √© 0 se NaN


                if (upfValue <= 0) {
                     alert('Por favor, informe o valor da UPF.'); return;
                }
                if (tempoDiurno === 0 && tempoNoturno === 0) {
                     alert('Por favor, informe o tempo de funcionamento (diurno ou noturno).'); return;
                }
                if (areaConstruida === 0 && areaEconomica === 0 && areaSemExploracao === 0) {
                    alert('Por favor, informe ao menos um tipo de √°rea do estabelecimento (constru√≠da, econ√¥mica ou sem explora√ß√£o).'); return;
                }


                const componenteTempo = (0.15 * tempoDiurno) + (0.20 * tempoNoturno);
                const K = areaConstruida > 0 ? obterFatorAtividade(areaConstruida) : 0;
                const X = areaEconomica > 0 ? obterFatorAtividade(areaEconomica) : 0;
                const Y = areaSemExploracao > 0 ? obterFatorAtividade(areaSemExploracao) : 0;
                const componenteArea = (K * 1.0) + (X * 0.75) + (Y * 0.25);
                const tffr = componenteTempo * componenteArea;
                const tffrReais = tffr * upfValue;

                const resultado = { id: Date.now(), tipo: 'TFFR', nomeEstabelecimento, data: new Date().toLocaleDateString('pt-BR'), hora: new Date().toLocaleTimeString('pt-BR'), dados: { upfValue, tempoDiurno, tempoNoturno, areaConstruida, areaEconomica, areaSemExploracao }, calculo: { componenteTempo, componenteArea, K, X, Y, tffr, tffrReais } };
                relatorios.push(resultado);
                salvarRelatorios();
                mostrarResultadoTFFR(resultado); // Chamada para a fun√ß√£o completa
            } catch (error) { console.error('Erro TFFR:', error); alert('Erro no c√°lculo.'); }
        }

        function calcularLocalizacao() {
             try {
                if (typeof relatorios === 'undefined') relatorios = [];
                const upfValue = parseFloat(document.getElementById('upf-localizacao').value) || 0;
                const nomeEstabelecimento = document.getElementById('nome-estabelecimento-localizacao').value || 'Estabelecimento n√£o informado';
                const endereco = document.getElementById('endereco-localizacao').value || 'Endere√ßo n√£o informado';
                const tipoAtividade = document.getElementById('tipo-atividade').value;

                if (upfValue <= 0) {
                    alert('Por favor, informe o valor da UPF.'); return;
                }
                if (!tipoAtividade) {
                    alert('Por favor, selecione o tipo de atividade.'); return;
                }
                if (tipoAtividade === 'nao-fisica') {
                    alert('Esta atividade N√ÉO est√° sujeita √† Taxa de Licen√ßa de Localiza√ß√£o, pois n√£o possui estabelecimento f√≠sico de funcionamento.');
                    document.getElementById('localizacao-result').style.display = 'none';
                    return;
                }

                const valorUPF = 6.0;
                const valorReais = valorUPF * upfValue;
                const resultado = { id: Date.now(), tipo: 'Licen√ßa de Localiza√ß√£o', nomeEstabelecimento, data: new Date().toLocaleDateString('pt-BR'), hora: new Date().toLocaleTimeString('pt-BR'), dados: { upfValue, endereco, tipoAtividade }, calculo: { valorUPF, valorReais } };
                relatorios.push(resultado);
                salvarRelatorios();
                mostrarResultadoLocalizacao(resultado);
            } catch (error) { console.error('Erro Localiza√ß√£o:', error); alert('Erro no c√°lculo.'); }
        }

        function calcularPublicidade() {
            try {
                if (typeof relatorios === 'undefined') relatorios = [];
                const upfValue = parseFloat(document.getElementById('upf-publicidade').value) || 0;
                const nomeEstabelecimento = document.getElementById('nome-estabelecimento-publicidade').value || 'Estabelecimento n√£o informado';
                const taxaAutorizacao = document.getElementById('taxa-autorizacao').checked;

                if (upfValue <= 0) {
                    alert('Por favor, informe o valor da UPF.'); return;
                }

                let totalUPF = 0;
                let itensCalculados = [];

                if (taxaAutorizacao) {
                    totalUPF += 1.0;
                    itensCalculados.push({ tipo: 'Taxa de Autoriza√ß√£o de Publicidade', quantidade: 1, valorUPF: 1.0, valorReais: 1.0 * upfValue, periodicidade: '√önica' });
                }

                const tiposFiscalizacao = [
                    { id: '2-1', nome: 'Letreiros na parte externa dos edif√≠cios', valor: 1.0, unidade: 'm¬≤', periodo: 'Por Ano' }, { id: '2-2', nome: 'Ve√≠culo de transporte (interna/externa)', valor: 1.5, unidade: 'm¬≤', periodo: 'Por Ano' },
                    { id: '2-3', nome: 'Dispositivo televis√≠vel ou tecnologia similar', valor: 1.0, unidade: 'm¬≤', periodo: 'Por Ano' }, { id: '2-4', nome: 'Condu√ß√£o por pessoas em vias p√∫blicas', valor: 1.0, unidade: 'unid', periodo: 'Por Ano' },
                    { id: '2-5', nome: 'Faixa exposta por tempo determinado', valor: 0.1, unidade: 'm¬≤', periodo: 'Por Evento' }, { id: '2-6', nome: 'Fl√¢mulas e bandeirolas (at√© 1m¬≤)', valor: 1.0, unidade: 'unid', periodo: 'Por Evento' },
                    { id: '2-7', nome: 'Placas indicativas de atividades', valor: 1.0, unidade: 'm¬≤', periodo: 'Por Ano' }, { id: '2-8', nome: 'Totem publicit√°rio', valor: 1.5, unidade: 'm¬≤', periodo: 'Por Ano' },
                    { id: '2-9', nome: 'Dispositivo infl√°vel', valor: 1.0, unidade: 'unid', periodo: 'Por Evento' }, { id: '2-10', nome: 'Propaganda m√≥vel sonora', valor: 2.0, unidade: 'unid', periodo: 'Por Ano' },
                    { id: '2-11', nome: 'Outdoor', valor: 2.0, unidade: 'unid', periodo: 'Por Ano' }, { id: '2-12', nome: 'Painel luminoso ou iluminado', valor: 0.2, unidade: 'm¬≤', periodo: 'Por Ano' }
                ];

                tiposFiscalizacao.forEach(tipo => {
                    const checkbox = document.getElementById(`tipo-${tipo.id}`);
                    if (checkbox && checkbox.checked) {
                        let quantidade = (tipo.unidade === 'm¬≤') ? parseFloat(document.getElementById(`area-${tipo.id}`).value) || 0 : parseFloat(document.getElementById(`qtd-${tipo.id}`).value) || 0;
                        if (quantidade > 0) {
                            const valorUPFItem = tipo.valor * quantidade;
                            totalUPF += valorUPFItem;
                            itensCalculados.push({ tipo: `Taxa de Fiscaliza√ß√£o - ${tipo.nome}`, quantidade, valorUnitario: tipo.valor, valorUPF: valorUPFItem, valorReais: valorUPFItem * upfValue, unidade: tipo.unidade, periodicidade: tipo.periodo });
                        }
                    }
                });

                if (itensCalculados.length === 0) {
                    alert('Por favor, selecione ao menos uma taxa de publicidade.'); return;
                }
                const totalReais = totalUPF * upfValue;
                const resultado = { id: Date.now(), tipo: 'Taxas de Publicidade', nomeEstabelecimento, data: new Date().toLocaleDateString('pt-BR'), hora: new Date().toLocaleTimeString('pt-BR'), dados: { upfValue, taxaAutorizacao }, calculo: { itensCalculados, totalUPF, totalReais } };
                relatorios.push(resultado);
                salvarRelatorios();
                mostrarResultadoPublicidade(resultado);
            } catch (error) { console.error('Erro Publicidade:', error); alert('Erro no c√°lculo.'); }
        }

        function calcularLogradouro() {
            try {
                if (typeof relatorios === 'undefined') relatorios = [];
                const upfValue = parseFloat(document.getElementById('upf-logradouro').value) || 0;
                const nomeEstabelecimento = document.getElementById('nome-estabelecimento-logradouro').value || 'Estabelecimento n√£o informado';
                const taxaAutorizacao = document.getElementById('taxa-autorizacao-logradouro').checked;

                if (upfValue <= 0) {
                    alert('Por favor, informe o valor da UPF.'); return;
                }

                let totalUPF = 0;
                let itensCalculados = [];

                if (taxaAutorizacao) {
                    totalUPF += 0.5;
                    itensCalculados.push({ tipo: 'Taxa de Autoriza√ß√£o de Uso', quantidade: 1, valorUPF: 0.5, valorReais: 0.5 * upfValue, periodicidade: '√önica' });
                }

                const tiposFiscalizacao = [
                    { id: '2-1', nome: 'Itinerante em Local Franqueado', valor: 2.0, periodo: 'Por Ano' }, { id: '2-1-1', nome: 'Itinerante - eventos espor√°dicos', valor: 0.0056, periodo: 'Por Dia', multiplicador: 'dias' },
                    { id: '2-1-2', nome: 'Estacionado Guloseimas', valor: 3.0, periodo: 'Por Ano' }, { id: '2-1-2-1', nome: 'Guloseimas - eventos espor√°dicos', valor: 0.0083, periodo: 'Por Dia', multiplicador: 'dias' },
                    { id: '2-1-3', nome: 'Estacionado Com√©rcio Geral', valor: 5.0, periodo: 'Por Ano' }, { id: '2-1-3-1', nome: 'Com√©rcio Geral - eventos espor√°dicos', valor: 0.014, periodo: 'Por Dia', multiplicador: 'dias' },
                    { id: '2-1-4', nome: 'Estacionado Tipo Banca at√© 2m¬≤', valor: 0.5, periodo: 'Por M√™s' }, { id: '2-1-4-1', nome: 'Banca at√© 2m¬≤ - eventos espor√°dicos', valor: 0.0014, periodo: 'Por Dia', multiplicador: 'dias' },
                    { id: '2-1-5', nome: '√Årea privada com barraca', valor: 1.0, periodo: 'Por Ano', multiplicador: 'area' }, { id: '2-1-5-1', nome: 'Barraca - eventos espor√°dicos', valor: 0.003, periodo: 'Por Dia', multiplicador: 'area-dias' },
                    { id: '2-1-6', nome: 'Adicional Mesas e Cadeiras', valor: 0.005, periodo: 'Por Dia', multiplicador: 'area-dias' }, { id: '2-2-1', nome: 'Feiras Populares', valor: 5.0, periodo: 'Por Ano' },
                    { id: '2-2-2', nome: 'Feiras livres itinerantes', valor: 5.0, periodo: 'Por Ano' }, { id: '2-2-3', nome: 'Atividades comerciais prec√°rias', valor: 0.005, periodo: 'Por Dia', multiplicador: 'area-dias' },
                    { id: '2-2-4', nome: 'Festa Popular, Carnaval', valor: 0.002, periodo: 'Por Dia', multiplicador: 'area-dias' }, { id: '2-2-5', nome: 'Feriados Religiosos', valor: 0.001, periodo: 'Por Dia', multiplicador: 'area-dias' },
                    { id: '2-3', nome: 'Mesas e Cadeiras na Cal√ßada', valor: 0.10, periodo: 'Por Ano', multiplicador: 'area' }, { id: '2-4-1', nome: 'Ve√≠culo Adaptado', valor: 1.20, periodo: 'Por Ano', multiplicador: 'area' },
                    { id: '2-4-1-1', nome: 'Ve√≠culo - eventos espor√°dicos', valor: 0.0033, periodo: 'Por Dia', multiplicador: 'area-dias' }, { id: '2-5', nome: 'Banca de Jornal e Revistas', valor: 0.50, periodo: 'Por Ano', multiplicador: 'area' },
                    { id: '2-6-1', nome: 'Com√©rcio em estrutura aprovada', valor: 1.50, periodo: 'Por Ano', multiplicador: 'area' }, { id: '2-6-3', nome: 'M√°quina de Sorvete e similares', valor: 1.50, periodo: 'Por Ano' }
                ];

                tiposFiscalizacao.forEach(tipo => {
                    const checkbox = document.getElementById(`item-${tipo.id}`);
                    if (checkbox && checkbox.checked) {
                        let quantidade = 1; let valorUPFItem = tipo.valor;
                        if (tipo.multiplicador === 'area') {
                            const area = parseFloat(document.getElementById(`area-${tipo.id}`).value) || 0;
                            if (area > 0) { quantidade = area; valorUPFItem = tipo.valor * area; } else return;
                        } else if (tipo.multiplicador === 'dias') {
                            const dias = parseFloat(document.getElementById(`dias-${tipo.id}`).value) || 0;
                            if (dias > 0) { quantidade = dias; valorUPFItem = tipo.valor * dias; } else return;
                        } else if (tipo.multiplicador === 'area-dias') {
                            const area = parseFloat(document.getElementById(`area-${tipo.id}`).value) || 0;
                            const dias = parseFloat(document.getElementById(`dias-${tipo.id}`).value) || 0;
                            if (area > 0 && dias > 0) { quantidade = area * dias; valorUPFItem = tipo.valor * area * dias; } else return;
                        }
                        if (valorUPFItem > 0) {
                            totalUPF += valorUPFItem;
                            itensCalculados.push({ tipo: `Taxa de Fiscaliza√ß√£o - ${tipo.nome}`, quantidade, valorUnitario: tipo.valor, valorUPF: valorUPFItem, valorReais: valorUPFItem * upfValue, periodicidade: tipo.periodo });
                        }
                    }
                });

                if (itensCalculados.length === 0) {
                    alert('Por favor, selecione ao menos uma taxa de uso de logradouro.'); return;
                }
                const totalReais = totalUPF * upfValue;
                const resultado = { id: Date.now(), tipo: 'Taxas de Logradouro', nomeEstabelecimento, data: new Date().toLocaleDateString('pt-BR'), hora: new Date().toLocaleTimeString('pt-BR'), dados: { upfValue, taxaAutorizacao }, calculo: { itensCalculados, totalUPF, totalReais } };
                relatorios.push(resultado);
                salvarRelatorios();
                mostrarResultadoLogradouro(resultado);
            } catch (error) { console.error('Erro Logradouro:', error); alert('Erro no c√°lculo.'); }
        }
        
        function calcularSanitaria() {
            try {
                if (typeof relatorios === 'undefined') relatorios = [];
                const upfValue = parseFloat(document.getElementById('upf-sanitaria').value) || 0;
                const nomeEstabelecimento = document.getElementById('nome-estabelecimento-sanitaria').value || 'Estabelecimento n√£o informado';
                const tipoTaxa = document.getElementById('tipo-taxa-sanitaria').value;

                if (upfValue <= 0) { alert('Por favor, informe o valor da UPF.'); return; }
                if (!tipoTaxa) { alert('Por favor, selecione o tipo de taxa sanit√°ria.'); return; }

                let totalUPF = 0; let detalhesCalculo = ''; let tipoTexto = '';

                if (tipoTaxa === 'licenca') {
                    const area = parseFloat(document.getElementById('area-licenca').value) || 0;
                    const reinspecao = document.getElementById('reinspecao-licenca').checked;
                    if (area <= 0) { alert('Por favor, informe a √°rea do estabelecimento.'); return; }
                    let valorBase = (area <= 30) ? 1 : (area <= 60) ? 2 : (area <= 90) ? 3 : (area <= 120) ? 4 : 5;
                    totalUPF = valorBase + (reinspecao ? 1 : 0);
                    tipoTexto = 'Licen√ßa Sanit√°ria';
                    detalhesCalculo = `<div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin: 15px 0; color: #2d3748;"><strong>üìè √Årea:</strong> ${area.toLocaleString('pt-BR')} m¬≤<br><strong>üí∞ Valor base:</strong> ${valorBase} UPF<br>${reinspecao ? '<strong>üîç Reinspe√ß√£o:</strong> +1 UPF<br>' : ''}<strong>üßÆ Total:</strong> ${totalUPF.toFixed(2)} UPF</div>`;
                } else if (tipoTaxa === 'fiscalizacao') {
                    const area = parseFloat(document.getElementById('area-tfs').value) || 0;
                    const tempoFuncionamento = parseFloat(document.getElementById('tempo-funcionamento-tfs').value) || 0;
                    if (area <= 0) { alert('Por favor, informe a √°rea do estabelecimento.'); return; }
                    if (tempoFuncionamento === 0) { alert('Por favor, selecione o tempo de funcionamento.'); return; }
                    let upfArea = (area <= 30) ? 2 : (area <= 60) ? 3 : (area <= 90) ? 4 : (area <= 120) ? 5 : (5 + (Math.ceil((area - 120) / 50) * 0.5));
                    totalUPF = upfArea * tempoFuncionamento * 1.00; // Custo operacional 1.00
                    tipoTexto = 'Taxa de Fiscaliza√ß√£o Sanit√°ria (TFS)';
                    detalhesCalculo = `<div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin: 15px 0; color: #2d3748;"><strong>üìè √Årea:</strong> ${area.toLocaleString('pt-BR')} m¬≤<br><strong>üìä UPF por √°rea:</strong> ${upfArea.toFixed(2)}<br><strong>‚è∞ Tempo funcionamento:</strong> ${(tempoFuncionamento * 100)}% (${tempoFuncionamento.toFixed(2)})<br><strong>üîß Custo operacional:</strong> 1.00 (Risco Alto)<br><strong>üßÆ C√°lculo:</strong> ${upfArea.toFixed(2)} √ó ${tempoFuncionamento.toFixed(2)} √ó 1.00 = ${totalUPF.toFixed(2)} UPF</div>`;
                } else if (tipoTaxa === 'veiculo') {
                    const tiposVeiculos = [
                        { id: 'ambulancia', nome: 'Ambul√¢ncia', valor: 3.0 }, { id: 'ambulancia-vet', nome: 'Ambul√¢ncia veterin√°ria', valor: 2.0 }, { id: 'aviao-uti', nome: 'Avi√£o UTI', valor: 6.0 },
                        { id: 'bau-engate', nome: 'Ba√∫ com engate', valor: 0.5 }, { id: 'caminhao-bau', nome: 'Caminh√£o ba√∫ lonado', valor: 1.0 }, { id: 'bau-isotermico', nome: 'Caminh√£o ba√∫ isot√©rmico', valor: 2.0 },
                        { id: 'pipa', nome: 'Caminh√£o pipa', valor: 2.0 }, { id: 'limpa-fossa', nome: 'Caminh√£o limpa fossa', valor: 3.0 }, { id: 'trailer', nome: 'Trailers', valor: 1.5 }, { id: 'furgao', nome: 'Ve√≠culos furg√µes', valor: 2.0 }
                    ];
                    let detalhesVeiculos = [];
                    tiposVeiculos.forEach(v => {
                        const cb = document.getElementById(`veiculo-${v.id}`);
                        if (cb && cb.checked) {
                            const qtd = parseFloat(document.getElementById(`qtd-${v.id}`).value) || 0;
                            if (qtd > 0) { const val = v.valor * qtd; totalUPF += val; detalhesVeiculos.push(`‚Ä¢ ${v.nome}: ${qtd} √ó ${v.valor.toFixed(1)} = ${val.toFixed(1)} UPF`); }
                        }
                    });
                    if (detalhesVeiculos.length === 0) { alert('Selecione ao menos um tipo de ve√≠culo.'); return; }
                    tipoTexto = 'Inspe√ß√£o Sanit√°ria de Ve√≠culos';
                    detalhesCalculo = `<div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin: 15px 0; color: #2d3748;"><strong>üöë Ve√≠culos:</strong><br>${detalhesVeiculos.join('<br>')}<br><br><strong>üßÆ Total:</strong> ${totalUPF.toFixed(1)} UPF</div>`;
                } else if (tipoTaxa === 'evento') {
                    const areaM = parseFloat(document.getElementById('area-manipulacao').value) || 0;
                    const diasE = parseFloat(document.getElementById('dias-evento').value) || 0;
                    const pontosC = parseFloat(document.getElementById('pontos-comercializacao').value) || 1;
                    if (areaM <= 0 || diasE <= 0) { alert('Informe √°rea e dias do evento.'); return; }
                    let valorPD = (areaM <= 10) ? 0.5 : (areaM <= 20) ? 1.0 : (areaM <= 50) ? 1.5 : 2.0;
                    totalUPF = valorPD * diasE * pontosC;
                    tipoTexto = 'Fiscaliza√ß√£o para Evento Tempor√°rio';
                    detalhesCalculo = `<div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin: 15px 0; color: #2d3748;"><strong>üìè √Årea:</strong> ${areaM.toLocaleString('pt-BR')} m¬≤<br><strong>üìÖ Dias:</strong> ${diasE}<br><strong>üè™ Pontos:</strong> ${pontosC}<br><strong>üí∞ Valor/dia/ponto:</strong> ${valorPD.toFixed(1)} UPF<br><strong>üßÆ Total:</strong> ${totalUPF.toFixed(1)} UPF</div>`;
                } else if (tipoTaxa === 'agua') {
                    const uniH = parseFloat(document.getElementById('unidades-habitacionais').value) || 0;
                    if (uniH <= 0) { alert('Informe unidades habitacionais.'); return; }
                    totalUPF = (uniH <= 10) ? 5.0 : (uniH <= 100) ? (5.0 + (uniH - 10) * 0.15) : (5.0 + (90 * 0.15) + (uniH - 100) * 0.10);
                    tipoTexto = 'Fiscaliza√ß√£o da Qualidade da √Ågua';
                    detalhesCalculo = `<div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin: 15px 0; color: #2d3748;"><strong>üè† Unidades:</strong> ${uniH.toLocaleString('pt-BR')}<br><strong>üí∞ Base:</strong> 5,00 UPF<br>${uniH > 10 ? `<strong>‚ûï Adicional:</strong> ${(totalUPF - 5).toFixed(2)} UPF<br>` : ''}<strong>üßÆ Total:</strong> ${totalUPF.toFixed(2)} UPF</div>`;
                } else if (tipoTaxa === 'ambulante') {
                    const qtdA = parseFloat(document.getElementById('qtd-ambulantes').value) || 1;
                    totalUPF = 1.0 * qtdA;
                    tipoTexto = 'Autoriza√ß√£o Sanit√°ria para Ambulantes';
                    detalhesCalculo = `<div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin: 15px 0; color: #2d3748;"><strong>üõí Estruturas:</strong> ${qtdA}<br><strong>üí∞ Valor/estrutura:</strong> 1,00 UPF<br><strong>üßÆ Total:</strong> ${totalUPF.toFixed(1)} UPF</div>`;
                }

                const totalReais = totalUPF * upfValue;
                const resultado = { id: Date.now(), tipo: tipoTexto, nomeEstabelecimento, data: new Date().toLocaleDateString('pt-BR'), hora: new Date().toLocaleTimeString('pt-BR'), dados: { upfValue, tipoTaxa }, calculo: { totalUPF, totalReais, detalhesCalculo } };
                relatorios.push(resultado);
                salvarRelatorios();
                mostrarResultadoSanitaria(resultado);
            } catch (error) { console.error('Erro Sanit√°ria:', error); alert('Erro no c√°lculo.'); }
        }


        function calcularAmbientalFiscalizacao() {
            try {
                if (typeof relatorios === 'undefined') relatorios = [];
                const upfValue = parseFloat(document.getElementById('upf-ambiental-fiscalizacao').value) || 0;
                const nomeEmpreendimento = document.getElementById('nome-empreendimento-fiscalizacao').value || 'N√£o informado';
                const porte = document.getElementById('porte-fiscalizacao').value;

                if (upfValue <= 0 || !porte) {
                    alert('Verifique se todos os campos (UPF, Porte) est√£o preenchidos.'); return;
                }

                const taxaUPF = taxasFiscalizacaoAmbiental[porte]; 
                const taxaReais = taxaUPF * upfValue;

                const resultado = { id: Date.now(), tipo: 'Fiscaliza√ß√£o Ambiental', nomeEstabelecimento: nomeEmpreendimento, data: new Date().toLocaleDateString('pt-BR'), hora: new Date().toLocaleTimeString('pt-BR'), dados: { upfValue, porte }, calculo: { taxaUPF, taxaReais } };
                relatorios.push(resultado);
                salvarRelatorios();
                mostrarResultadoAmbientalFiscalizacao(resultado);
            } catch (error) { console.error('Erro Fiscaliza√ß√£o Ambiental:', error); alert('Erro no c√°lculo.'); }
        }

        function calcularAmbientalLicenca() {
            try {
                if (typeof relatorios === 'undefined') relatorios = [];
                const upfValue = parseFloat(document.getElementById('upf-ambiental-licenca').value) || 0;
                const nomeEmpreendimento = document.getElementById('nome-empreendimento-licenca').value || 'N√£o informado';
                const tipoLicenca = document.getElementById('tipo-licenca-ambiental').value;
                const porteLicenca = document.getElementById('porte-licenca-ambiental').value;

                if (upfValue <= 0) {
                    alert('Informe o valor da UPF.'); return;
                }

                let totalUPF = 0;
                let itensCalculados = [];
                
                // 1. Taxa da Licen√ßa Principal
                if (tipoLicenca && (porteLicenca || tipoLicenca === 'las')) {
                    let taxaLicencaUPF = 0;
                    if (tipoLicenca === 'las') {
                        taxaLicencaUPF = taxasLicencaAmbiental.las.lai; 
                    } else if (taxasLicencaAmbiental[porteLicenca] && taxasLicencaAmbiental[porteLicenca][tipoLicenca]) {
                        taxaLicencaUPF = taxasLicencaAmbiental[porteLicenca][tipoLicenca]; 
                    }
                    if (taxaLicencaUPF > 0) {
                        totalUPF += taxaLicencaUPF;
                        itensCalculados.push({ descricao: `Licen√ßa ${tipoLicenca.toUpperCase()} - Porte ${porteLicenca ? porteLicenca.toUpperCase() : 'N/A (LAS)'}`, valorUPF: taxaLicencaUPF });
                    }
                }
                
                const porteParaEstudo = porteLicenca || (tipoLicenca === 'las' ? 'lapp' : null); 
                
                // 2. An√°lise EIA/RIMA
                if (document.getElementById('incluir-eia-rima').checked && porteParaEstudo && taxasAnaliseEstudo.eia_rima[porteParaEstudo]) {
                    const taxaAnalise = taxasAnaliseEstudo.eia_rima[porteParaEstudo]; 
                    totalUPF += taxaAnalise;
                    itensCalculados.push({ descricao: 'An√°lise EIA/RIMA', valorUPF: taxaAnalise });
                }

                // 3. An√°lise EIV/RIV
                if (document.getElementById('incluir-eiv-riv').checked && porteParaEstudo && taxasAnaliseEstudo.eiv_riv[porteParaEstudo]) {
                    const taxaAnalise = taxasAnaliseEstudo.eiv_riv[porteParaEstudo]; 
                    totalUPF += taxaAnalise;
                    itensCalculados.push({ descricao: 'An√°lise EIV/RIV', valorUPF: taxaAnalise });
                }

                // 4. Certid√£o de Viabilidade
                if (document.getElementById('incluir-certidao-viabilidade').checked) {
                    const porteCertidao = document.getElementById('porte-certidao-viabilidade').value;
                    if (porteCertidao && taxasDiversasAmbiental.certidaoViabilidade[porteCertidao]) {
                        const taxaCertidao = taxasDiversasAmbiental.certidaoViabilidade[porteCertidao]; 
                        totalUPF += taxaCertidao;
                        itensCalculados.push({ descricao: `Certid√£o de Viabilidade - Porte ${porteCertidao}`, valorUPF: taxaCertidao });
                    }
                }

                // 5. Cadastro Simplificado
                if (document.getElementById('incluir-cadastro-simplificado').checked) {
                    const taxaCadastro = taxasDiversasAmbiental.cadastroSimplificado; 
                    totalUPF += taxaCadastro;
                    itensCalculados.push({ descricao: 'Cadastro Ambiental Simplificado', valorUPF: taxaCadastro });
                }

                if (itensCalculados.length === 0) {
                    alert('Selecione ao menos um tipo de licen√ßa ou servi√ßo para calcular.'); return;
                }

                const totalReais = totalUPF * upfValue;
                const resultado = { id: Date.now(), tipo: 'Licenciamento Ambiental', nomeEstabelecimento: nomeEmpreendimento, data: new Date().toLocaleDateString('pt-BR'), hora: new Date().toLocaleTimeString('pt-BR'), dados: { upfValue, itensCalculados }, calculo: { totalUPF, totalReais } };
                relatorios.push(resultado);
                salvarRelatorios();
                mostrarResultadoAmbientalLicenca(resultado);

            } catch (error) { console.error('Erro Licen√ßa Ambiental:', error); alert('Erro no c√°lculo.'); }
        }


        // --- L√ìGICA DE EXIBI√á√ÉO DE RESULTADOS ---
        // --- FUN√á√ÉO RESTAURADA E COMPLETA ---
        function mostrarResultadoTFFR(resultado) {
            const resultBox = document.getElementById('tffr-result');
            const { calculo, dados } = resultado;
            
            resultBox.innerHTML = `
                <h3>‚úÖ TFFR Calculada com Sucesso!</h3>
                <div style="font-size: 2em; margin: 15px 0;">
                    <strong>R$ ${calculo.tffrReais.toFixed(2)}</strong>
                </div>
                <div style="font-size: 1.1em;">
                    ${calculo.tffr.toFixed(2)} √ó UPF (R$ ${dados.upfValue.toFixed(2)})
                </div>
                
                <div class="result-details">
                    <h4 style="margin-bottom: 15px; color: #2d3748;">üìä Detalhes do C√°lculo:</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #e6fffa; padding: 15px; border-radius: 8px; color: #2d3748;">
                            <strong style="color: #1a202c;">‚è∞ Componente Tempo</strong><br>
                            <span style="color: #2d3748;">${calculo.componenteTempo.toFixed(2)} √ó UPF</span><br>
                            <small style="color: #4a5568;">${dados.tempoDiurno}h diurnas + ${dados.tempoNoturno}h noturnas</small>
                        </div>
                        <div style="background: #f0fff4; padding: 15px; border-radius: 8px; color: #2d3748;">
                            <strong style="color: #1a202c;">üìè Componente √Årea</strong><br>
                            <span style="color: #2d3748;">${calculo.componenteArea.toFixed(2)}</span><br>
                            <small style="color: #4a5568;">Fatores ponderados por coeficientes</small>
                        </div>
                    </div>
                    
                    <div style="background: #fef5e7; padding: 15px; border-radius: 8px; margin-bottom: 15px; color: #2d3748;">
                        <strong>üßÆ F√≥rmula aplicada:</strong><br>
                        TFFR = [(0,15 √ó ${dados.tempoDiurno}) + (0,20 √ó ${dados.tempoNoturno})] √ó [${calculo.componenteArea.toFixed(2)}]<br>
                        TFFR = ${calculo.componenteTempo.toFixed(2)} √ó ${calculo.componenteArea.toFixed(2)} = ${calculo.tffr.toFixed(2)} √ó UPF
                    </div>
                    
                    <div style="font-size: 0.9em; color: #4a5568; margin-top: 15px;">
                        <strong>üìä Resumo das √°reas utilizadas:</strong><br>
                        ${(() => {
                            const areaTotal = dados.areaConstruida + dados.areaEconomica + dados.areaSemExploracao;
                            const areas = [];
                            
                            if (dados.areaConstruida > 0) areas.push(dados.areaConstruida.toLocaleString('pt-BR'));
                            if (dados.areaEconomica > 0) areas.push(dados.areaEconomica.toLocaleString('pt-BR'));
                            if (dados.areaSemExploracao > 0) areas.push(dados.areaSemExploracao.toLocaleString('pt-BR'));
                            
                            let areaSoma = areas.length > 1 ? `${areas.join(' + ')} = ${areaTotal.toLocaleString('pt-BR')} m¬≤` : `${areaTotal.toLocaleString('pt-BR')} m¬≤`;
                            
                            return `üìè <strong>√Årea Total:</strong> ${areaSoma}`;
                        })()}<br><br>
                        <strong>üìä Fatores aplicados por tipo de √°rea:</strong><br>
                        ${dados.areaConstruida > 0 ? `‚Ä¢ √Årea constru√≠da ${dados.areaConstruida.toLocaleString('pt-BR')}m¬≤ ‚Üí Fator ${calculo.K.toFixed(2)} √ó Coef. 1,0 = ${(calculo.K * 1.0).toFixed(2)}<br>` : ''}
                        ${dados.areaEconomica > 0 ? `‚Ä¢ √Årea econ√¥mica ${dados.areaEconomica.toLocaleString('pt-BR')}m¬≤ ‚Üí Fator ${calculo.X.toFixed(2)} √ó Coef. 0,75 = ${(calculo.X * 0.75).toFixed(2)}<br>` : ''}
                        ${dados.areaSemExploracao > 0 ? `‚Ä¢ √Årea sem explora√ß√£o ${dados.areaSemExploracao.toLocaleString('pt-BR')}m¬≤ ‚Üí Fator ${calculo.Y.toFixed(2)} √ó Coef. 0,25 = ${(calculo.Y * 0.25).toFixed(2)}<br>` : ''}
                        <strong>Total do componente √°rea:</strong> ${calculo.componenteArea.toFixed(2)}
                    </div>
                </div>
            `;
            
            resultBox.style.display = 'block';
            resultBox.classList.add('sucesso'); // Para anima√ß√£o
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }

        function mostrarResultadoLocalizacao(resultado) {
            const resultBox = document.getElementById('localizacao-result');
            const { calculo, dados } = resultado;
            resultBox.innerHTML = `
                <h3>‚úÖ Taxa de Localiza√ß√£o Calculada com Sucesso!</h3>
                <div style="font-size: 2em; margin: 15px 0;"><strong>R$ ${calculo.valorReais.toFixed(2)}</strong></div>
                <div style="font-size: 1.1em;">${calculo.valorUPF.toFixed(1)} √ó UPF (R$ ${dados.upfValue.toFixed(2)})</div>
                <div class="result-details">
                    <h4 style="margin-bottom: 15px; color: #2d3748;">üìä Detalhes:</h4>
                    <div style="background: #e6fffa; padding: 15px; border-radius: 8px; color: #2d3748;">
                        <strong>üìç Estabelecimento:</strong> ${resultado.nomeEstabelecimento}<br>
                        <strong>üìß Endere√ßo:</strong> ${dados.endereco}<br>
                        <strong>üí∞ Valor fixo:</strong> 6 UPF (Taxa de Licen√ßa de Localiza√ß√£o)<br>
                        <strong>üîÑ Periodicidade:</strong> Pagamento √∫nico at√© mudan√ßa de endere√ßo
                    </div>
                </div>`;
            resultBox.style.display = 'block';
            resultBox.classList.add('sucesso');
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }
        
        function mostrarResultadoPublicidade(resultado) {
            const resultBox = document.getElementById('publicidade-result');
            const { calculo, dados } = resultado;
            let detalhesItens = calculo.itensCalculados.map(item => `
                <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div><strong>${item.tipo}</strong><br><small style="color: #6c757d;">${item.unidade === 'm¬≤' ? `${item.quantidade} m¬≤` : `${item.quantidade} unid`} √ó ${item.valorUnitario || item.valorUPF} UPF - ${item.periodicidade}</small></div>
                        <div style="text-align: right;"><strong style="color: #38a169; font-size: 1.2em;">R$ ${item.valorReais.toFixed(2)}</strong><br><small style="color: #6c757d;">${item.valorUPF.toFixed(2)} UPF</small></div>
                    </div>
                </div>`).join('');
            resultBox.innerHTML = `
                <h3>‚úÖ Taxas de Publicidade Calculadas!</h3>
                <div style="font-size: 2em; margin: 15px 0;"><strong>R$ ${calculo.totalReais.toFixed(2)}</strong></div>
                <div style="font-size: 1.1em;">${calculo.totalUPF.toFixed(2)} √ó UPF (R$ ${dados.upfValue.toFixed(2)})</div>
                <div class="result-details"><h4 style="margin-bottom: 15px; color: #2d3748;">üìä Itens:</h4>${detalhesItens}</div>`;
            resultBox.style.display = 'block';
            resultBox.classList.add('sucesso');
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }

        function mostrarResultadoLogradouro(resultado) {
            const resultBox = document.getElementById('logradouro-result');
            const { calculo, dados } = resultado;
            let detalhesItens = calculo.itensCalculados.map(item => `
                <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div><strong>${item.tipo}</strong><br><small style="color: #6c757d;">${item.quantidade === 1 ? '1 unid' : `${item.quantidade} unid/m¬≤/dias`} √ó ${item.valorUnitario || item.valorUPF} UPF - ${item.periodicidade}</small></div>
                        <div style="text-align: right;"><strong style="color: #38a169; font-size: 1.2em;">R$ ${item.valorReais.toFixed(2)}</strong><br><small style="color: #6c757d;">${item.valorUPF.toFixed(4)} UPF</small></div>
                    </div>
                </div>`).join('');
             resultBox.innerHTML = `
                <h3>‚úÖ Taxas de Logradouro Calculadas!</h3>
                <div style="font-size: 2em; margin: 15px 0;"><strong>R$ ${calculo.totalReais.toFixed(2)}</strong></div>
                <div style="font-size: 1.1em;">${calculo.totalUPF.toFixed(4)} √ó UPF (R$ ${dados.upfValue.toFixed(2)})</div>
                <div class="result-details"><h4 style="margin-bottom: 15px; color: #2d3748;">üìä Itens:</h4>${detalhesItens}</div>`;
            resultBox.style.display = 'block';
            resultBox.classList.add('sucesso');
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }

        function mostrarResultadoSanitaria(resultado) {
            const resultBox = document.getElementById('sanitaria-result');
            const { calculo, dados } = resultado;
            resultBox.innerHTML = `
                <h3>‚úÖ ${resultado.tipo} Calculada!</h3>
                <div style="font-size: 2em; margin: 15px 0;"><strong>R$ ${calculo.totalReais.toFixed(2)}</strong></div>
                <div style="font-size: 1.1em;">${calculo.totalUPF.toFixed(2)} √ó UPF (R$ ${dados.upfValue.toFixed(2)})</div>
                <div class="result-details"><h4 style="margin-bottom: 15px; color: #2d3748;">üìä Detalhes:</h4>${calculo.detalhesCalculo}</div>`;
            resultBox.style.display = 'block';
            resultBox.classList.add('sucesso');
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }
        
        function mostrarResultadoAmbientalFiscalizacao(resultado) {
            const resultBox = document.getElementById('ambiental-fiscalizacao-result');
            const { calculo, dados } = resultado;
            resultBox.innerHTML = `
                <h3>‚úÖ Taxa de Fiscaliza√ß√£o Ambiental Calculada!</h3>
                <div style="font-size: 2em; margin: 15px 0;"><strong>R$ ${calculo.taxaReais.toFixed(2)}</strong></div>
                <div style="font-size: 1.1em;">${calculo.taxaUPF.toFixed(2)} √ó UPF (R$ ${dados.upfValue.toFixed(2)})</div>
                <div class="result-details">
                    <h4 style="margin-bottom: 15px; color: #2d3748;">üìä Detalhes:</h4>
                    <div style="background: #e6fffa; padding: 15px; border-radius: 8px; color: #2d3748;">
                        <strong>üå± Empreendimento:</strong> ${resultado.nomeEstabelecimento}<br>
                        <strong>üìè Porte:</strong> ${dados.porte.toUpperCase()}<br>
                        <strong>üí∞ Taxa:</strong> ${calculo.taxaUPF.toFixed(2)} UPF
                    </div>
                </div>`;
            resultBox.style.display = 'block';
            resultBox.classList.add('sucesso');
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }

        function mostrarResultadoAmbientalLicenca(resultado) {
            const resultBox = document.getElementById('ambiental-licenca-result');
            const { calculo, dados } = resultado;
            let detalhesItens = dados.itensCalculados.map(item => `
                <div style="display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #e2e8f0; color: #2d3748;">
                    <span>${item.descricao}</span>
                    <span style="font-weight: bold;">${item.valorUPF.toFixed(2)} UPF</span>
                </div>`).join('');

            resultBox.innerHTML = `
                <h3>‚úÖ Taxas de Licenciamento Ambiental Calculadas!</h3>
                <div style="font-size: 2em; margin: 15px 0;"><strong>R$ ${calculo.totalReais.toFixed(2)}</strong></div>
                <div style="font-size: 1.1em;">Total: ${calculo.totalUPF.toFixed(2)} √ó UPF (R$ ${dados.upfValue.toFixed(2)})</div>
                <div class="result-details">
                    <h4 style="margin-bottom: 15px; color: #2d3748;">üìä Detalhamento:</h4>
                    ${detalhesItens}
                </div>`;
            resultBox.style.display = 'block';
            resultBox.classList.add('sucesso');
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }


        // --- L√ìGICA DE LIMPEZA DOS FORMUL√ÅRIOS ---
        function limparFormulario() {
            document.getElementById('upf-value').value = '103.67';
            document.getElementById('alterar-upf-tffr').checked = false;
            document.getElementById('upf-value').disabled = true;
            document.getElementById('nome-estabelecimento').value = '';
            document.getElementById('tempo-diurno').value = '';
            document.getElementById('tempo-noturno').value = '';
            document.getElementById('area-construida').value = '0';
            document.getElementById('area-economica').value = '0';
            document.getElementById('area-sem-exploracao').value = '0';
            document.getElementById('tffr-result').style.display = 'none';
        }
        function limparFormularioLocalizacao() {
            document.getElementById('upf-localizacao').value = '103.67';
            document.getElementById('alterar-upf-localizacao').checked = false;
            document.getElementById('upf-localizacao').disabled = true;
            document.getElementById('nome-estabelecimento-localizacao').value = '';
            document.getElementById('endereco-localizacao').value = '';
            document.getElementById('tipo-atividade').value = '';
            document.getElementById('info-nao-sujeita').style.display = 'none';
            document.getElementById('localizacao-result').style.display = 'none';
        }
        function limparFormularioPublicidade() {
            document.getElementById('upf-publicidade').value = '103.67';
            document.getElementById('alterar-upf-publicidade').checked = false;
            document.getElementById('upf-publicidade').disabled = true;
            document.getElementById('nome-estabelecimento-publicidade').value = '';
            document.getElementById('taxa-autorizacao').checked = false;
            document.querySelectorAll('#tipos-publicidade input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('#tipos-publicidade input[type="number"]').forEach(input => { input.value = ''; input.disabled = true; });
            document.querySelectorAll('#tipos-publicidade .publicidade-item').forEach(item => item.classList.remove('item-selecionado'));
            document.getElementById('publicidade-result').style.display = 'none';
        }
        function limparFormularioLogradouro() {
            document.getElementById('upf-logradouro').value = '103.67';
            document.getElementById('alterar-upf-logradouro').checked = false;
            document.getElementById('upf-logradouro').disabled = true;
            document.getElementById('nome-estabelecimento-logradouro').value = '';
            document.getElementById('taxa-autorizacao-logradouro').checked = false;
            document.querySelectorAll('#categorias-logradouro input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('#categorias-logradouro input[type="number"]').forEach(input => { input.value = ''; input.disabled = true; });
            document.querySelectorAll('#categorias-logradouro .logradouro-item').forEach(item => item.classList.remove('item-selecionado'));
            document.getElementById('logradouro-result').style.display = 'none';
        }
        function limparFormularioSanitaria() {
            document.getElementById('upf-sanitaria').value = '103.67';
            document.getElementById('alterar-upf-sanitaria').checked = false;
            document.getElementById('upf-sanitaria').disabled = true;
            document.getElementById('nome-estabelecimento-sanitaria').value = '';
            document.getElementById('tipo-taxa-sanitaria').value = '';
            document.querySelectorAll('.taxa-sanitaria-section').forEach(secao => secao.style.display = 'none');
            // Limpar campos espec√≠ficos de cada se√ß√£o sanit√°ria
            document.getElementById('area-licenca').value = ''; document.getElementById('reinspecao-licenca').checked = false;
            document.getElementById('area-tfs').value = ''; document.getElementById('tempo-funcionamento-tfs').value = '';
            document.querySelectorAll('#tipos-veiculos input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('#tipos-veiculos input[type="number"]').forEach(input => { input.value = ''; input.disabled = true; });
            document.querySelectorAll('#tipos-veiculos .veiculo-item').forEach(item => item.classList.remove('item-selecionado'));
            document.getElementById('area-manipulacao').value = ''; document.getElementById('dias-evento').value = ''; document.getElementById('pontos-comercializacao').value = '1';
            document.getElementById('unidades-habitacionais').value = ''; document.getElementById('qtd-ambulantes').value = '1';
            document.getElementById('sanitaria-result').style.display = 'none';
        }

        function limparFormularioAmbientalFiscalizacao() {
            document.getElementById('upf-ambiental-fiscalizacao').value = '103.67';
            document.getElementById('alterar-upf-ambiental-fiscalizacao').checked = false;
            document.getElementById('upf-ambiental-fiscalizacao').disabled = true;
            document.getElementById('nome-empreendimento-fiscalizacao').value = '';
            document.getElementById('porte-fiscalizacao').value = '';
            document.getElementById('ambiental-fiscalizacao-result').style.display = 'none';
        }

        function limparFormularioAmbientalLicenca() {
            document.getElementById('upf-ambiental-licenca').value = '103.67';
            document.getElementById('alterar-upf-ambiental-licenca').checked = false;
            document.getElementById('upf-ambiental-licenca').disabled = true;
            document.getElementById('nome-empreendimento-licenca').value = '';
            document.getElementById('tipo-licenca-ambiental').value = '';
            document.getElementById('porte-licenca-ambiental').value = '';
            document.getElementById('porte-licenca-ambiental').disabled = false;
            document.getElementById('incluir-eia-rima').checked = false;
            document.getElementById('incluir-eiv-riv').checked = false;
            document.getElementById('incluir-certidao-viabilidade').checked = false;
            document.getElementById('incluir-cadastro-simplificado').checked = false;
            document.getElementById('porte-certidao-viabilidade').value = '';
            toggleViabilidadePorte(false);
            document.getElementById('ambiental-licenca-result').style.display = 'none';
        }

        // --- L√ìGICA DE RELAT√ìRIOS ---
        function atualizarRelatorios() {
            const container = document.getElementById('relatorios-container');
            const totalContainer = document.getElementById('relatorio-total');
            const valorTotalGeral = document.getElementById('valor-total-geral');
            
            if (relatorios.length === 0) {
                container.innerHTML = `<div style="text-align: center; color: #a0aec0; font-size: 1.2em; margin: 50px 0;">üìã Nenhum c√°lculo realizado ainda</div>`;
                totalContainer.style.display = 'none';
                return;
            }
            
            let totalGeral = 0;
            let html = '';
            
            [...relatorios].reverse().forEach(relatorio => { // Usar spread para evitar modificar o array original ao reverter
                let valorRelatorio = 0;
                if (relatorio.calculo.tffrReais !== undefined) valorRelatorio = relatorio.calculo.tffrReais;
                else if (relatorio.calculo.valorReais !== undefined) valorRelatorio = relatorio.calculo.valorReais;
                else if (relatorio.calculo.totalReais !== undefined) valorRelatorio = relatorio.calculo.totalReais;
                else if (relatorio.calculo.taxaReais !== undefined) valorRelatorio = relatorio.calculo.taxaReais;

                totalGeral += valorRelatorio;
                
                // Adicionar mais detalhes se necess√°rio, similar √† vers√£o 1
                let detalhesEspecificos = '';
                 if (relatorio.tipo === 'TFFR') {
                    detalhesEspecificos = `
                        <div style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
                           Funcionamento: ${relatorio.dados.tempoDiurno}h diurno + ${relatorio.dados.tempoNoturno}h noturno<br>
                           √Åreas: ${relatorio.dados.areaConstruida}m¬≤ (C) + ${relatorio.dados.areaEconomica}m¬≤ (E) + ${relatorio.dados.areaSemExploracao}m¬≤ (S/E)<br>
                           Total UPF: ${relatorio.calculo.tffr.toFixed(2)}
                        </div>`;
                } else if (relatorio.tipo === 'Licen√ßa de Localiza√ß√£o') {
                     detalhesEspecificos = `<div style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">Endere√ßo: ${relatorio.dados.endereco || 'N/A'}<br>Total UPF: ${relatorio.calculo.valorUPF.toFixed(1)}</div>`;
                } else if (relatorio.tipo === 'Taxas de Publicidade' || relatorio.tipo === 'Taxas de Logradouro') {
                    if(relatorio.calculo.itensCalculados && relatorio.calculo.itensCalculados.length > 0){
                        detalhesEspecificos = `<div style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">Itens: ${relatorio.calculo.itensCalculados.length}<br>Total UPF: ${relatorio.calculo.totalUPF.toFixed(relatorio.tipo === 'Taxas de Logradouro' ? 4 : 2)}</div>`;
                    }
                } else if (relatorio.tipo.includes('Sanit√°ria') || relatorio.tipo.includes('Sanit√°rio')) {
                     detalhesEspecificos = `<div style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">Total UPF: ${relatorio.calculo.totalUPF.toFixed(2)}</div>`;
                } else if (relatorio.tipo === 'Fiscaliza√ß√£o Ambiental') {
                    detalhesEspecificos = `<div style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">Porte: ${relatorio.dados.porte.toUpperCase()}<br>Total UPF: ${relatorio.calculo.taxaUPF.toFixed(2)}</div>`;
                } else if (relatorio.tipo === 'Licenciamento Ambiental') {
                     if(relatorio.dados.itensCalculados && relatorio.dados.itensCalculados.length > 0){
                        detalhesEspecificos = `<div style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">Itens: ${relatorio.dados.itensCalculados.length}<br>Total UPF: ${relatorio.calculo.totalUPF.toFixed(2)}</div>`;
                    }
                }


                html += `
                    <div class="relatorio-item">
                        <div class="relatorio-header">
                            <div>
                                <h3 style="color: #2d3748;">${getIconeRelatorio(relatorio.tipo)} ${relatorio.tipo} - ${relatorio.nomeEstabelecimento || relatorio.nomeEmpreendimento}</h3>
                                <p style="color: #4a5568; margin: 5px 0;">üìÖ ${relatorio.data} √†s ${relatorio.hora}</p>
                            </div>
                            <div class="relatorio-valor">R$ ${valorRelatorio.toFixed(2)}</div>
                        </div>
                        ${detalhesEspecificos}
                        <div style="margin-top: 15px; text-align: right;">
                            <button class="calc-button" style="background: #e53e3e; font-size: 0.9em; padding: 8px 15px;" onclick="removerRelatorio(${relatorio.id})">üóëÔ∏è Remover</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            valorTotalGeral.textContent = `R$ ${totalGeral.toFixed(2)}`;
            totalContainer.style.display = 'block';
        }

        function getIconeRelatorio(tipo) {
            const icones = {
                'TFFR': 'üè¢', 'Licen√ßa de Localiza√ß√£o': 'üìç', 'Taxas de Publicidade': 'üì¢',
                'Taxas de Logradouro': 'üõ£Ô∏è', 'Fiscaliza√ß√£o Ambiental': 'üå±', 'Licenciamento Ambiental': 'üåø'
            };
            if(tipo && tipo.includes('Sanit')) return 'üß™'; // Verifica se tipo n√£o √© undefined antes de chamar includes
            return icones[tipo] || 'üìÑ';
        }

        function removerRelatorio(id) {
            if (confirm('Tem certeza que deseja remover este relat√≥rio?')) {
                relatorios = relatorios.filter(r => r.id !== id);
                salvarRelatorios();
                atualizarRelatorios();
            }
        }

        function limparRelatorios() {
            if (confirm('Tem certeza que deseja remover TODOS os relat√≥rios?')) {
                relatorios = [];
                salvarRelatorios();
                atualizarRelatorios();
            }
        }

        function exportarRelatorios() {
            if (relatorios.length === 0) { alert('N√£o h√° relat√≥rios para exportar.'); return; }
            
            let conteudo = `RELAT√ìRIO DE TAXAS MUNICIPAIS - PORTO VELHO\n`;
            conteudo += `Gerado em: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}\n`;
            conteudo += `${'='.repeat(60)}\n\n`;
            let totalGeralExport = 0;

            relatorios.forEach((relatorio, index) => {
                let valorRelatorio = 0;
                if (relatorio.calculo.tffrReais !== undefined) valorRelatorio = relatorio.calculo.tffrReais;
                else if (relatorio.calculo.valorReais !== undefined) valorRelatorio = relatorio.calculo.valorReais;
                else if (relatorio.calculo.totalReais !== undefined) valorRelatorio = relatorio.calculo.totalReais;
                else if (relatorio.calculo.taxaReais !== undefined) valorRelatorio = relatorio.calculo.taxaReais;
                
                totalGeralExport += valorRelatorio;
                const nome = relatorio.nomeEstabelecimento || relatorio.nomeEmpreendimento || 'N/A';

                conteudo += `${index + 1}. ${relatorio.tipo} - ${nome}\n`;
                conteudo += `   Data: ${relatorio.data} √†s ${relatorio.hora}\n`;
                conteudo += `   UPF Base: R$ ${relatorio.dados.upfValue.toFixed(2)}\n`;

                if (relatorio.tipo === 'TFFR') {
                    conteudo += `   Funcionamento: ${relatorio.dados.tempoDiurno}h diurno + ${relatorio.dados.tempoNoturno}h noturno\n`;
                    conteudo += `   √Åreas: ${relatorio.dados.areaConstruida}m¬≤ (C), ${relatorio.dados.areaEconomica}m¬≤ (E), ${relatorio.dados.areaSemExploracao}m¬≤ (S/E)\n`;
                    conteudo += `   Total UPF (TFFR): ${relatorio.calculo.tffr.toFixed(2)}\n`;
                } else if (relatorio.tipo === 'Licen√ßa de Localiza√ß√£o') {
                    conteudo += `   Endere√ßo: ${relatorio.dados.endereco || 'N/A'}\n`;
                    conteudo += `   Total UPF (Localiza√ß√£o): ${relatorio.calculo.valorUPF.toFixed(1)}\n`;
                } else if (relatorio.tipo === 'Taxas de Publicidade' || relatorio.tipo === 'Taxas de Logradouro') {
                    if(relatorio.calculo.itensCalculados){
                        relatorio.calculo.itensCalculados.forEach(item => {
                            conteudo += `     - ${item.tipo || item.descricao}: ${item.valorUPF.toFixed(item.tipo === 'Taxas de Logradouro' ? 4 : 2)} UPF (R$ ${item.valorReais.toFixed(2)})\n`;
                        });
                    }
                    conteudo += `   Total UPF (${relatorio.tipo}): ${relatorio.calculo.totalUPF.toFixed(relatorio.tipo === 'Taxas de Logradouro' ? 4 : 2)}\n`;
                } else if (relatorio.tipo.includes('Sanit')) {
                     conteudo += `   Total UPF (${relatorio.tipo}): ${relatorio.calculo.totalUPF.toFixed(2)}\n`;
                } else if (relatorio.tipo === 'Fiscaliza√ß√£o Ambiental') {
                    conteudo += `   Porte: ${relatorio.dados.porte.toUpperCase()}\n`;
                    conteudo += `   Total UPF (Fiscaliza√ß√£o Ambiental): ${relatorio.calculo.taxaUPF.toFixed(2)}\n`;
                } else if (relatorio.tipo === 'Licenciamento Ambiental') {
                     if(relatorio.dados.itensCalculados){
                        relatorio.dados.itensCalculados.forEach(item => {
                             conteudo += `     - ${item.descricao}: ${item.valorUPF.toFixed(2)} UPF\n`;
                        });
                    }
                    conteudo += `   Total UPF (Licenciamento Ambiental): ${relatorio.calculo.totalUPF.toFixed(2)}\n`;
                }
                
                conteudo += `   VALOR: R$ ${valorRelatorio.toFixed(2)}\n`;
                conteudo += `   ${'-'.repeat(40)}\n\n`;
            });

            conteudo += `TOTAL GERAL DOS RELAT√ìRIOS: R$ ${totalGeralExport.toFixed(2)}\n`;
            conteudo += `${'='.repeat(60)}\n`;

            const blob = new Blob([conteudo], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `relatorio_taxas_calculadora_${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }


        function setupUpfHandlers() {
            document.querySelectorAll('.alterar-upf-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const upfInput = document.getElementById(this.dataset.targetInput);
                    if (upfInput) {
                        upfInput.disabled = !this.checked;
                        if (!this.checked) upfInput.value = '103.67';
                        if (this.checked) upfInput.focus();
                    }
                });
            });
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof relatorios === 'undefined') relatorios = [];
                if (typeof currentCalculator === 'undefined') currentCalculator = 'tffr';
                
                carregarRelatorios();
                preencherTabelaFatores(); // Chamada restaurada
                atualizarRelatorios();
                setupUpfHandlers();
                
                mostrarCalculadora('tffr'); // Chamada que internamente usa preencherTabelaFatores()
                
                document.querySelectorAll('#tipos-publicidade input[type="number"], #categorias-logradouro input[type="number"], #tipos-veiculos input[type="number"]')
                    .forEach(input => { input.disabled = true; });
                
                console.log('App inicializado com sucesso - 7 calculadoras dispon√≠veis');
            } catch (error) {
                console.error('Erro na inicializa√ß√£o:', error);
                relatorios = [];
                currentCalculator = 'tffr';
                // Tentar garantir que a tabela seja preenchida mesmo em caso de erro anterior
                try { preencherTabelaFatores(); } catch (e) { console.error("Falha ao preencher tabela no fallback:", e); }
                mostrarCalculadora('tffr');
            }
        });
    </script>
</body>
</html>
 
